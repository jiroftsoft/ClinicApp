@model RegisterPatientViewModel
@{
    ViewBag.Title = "تکمیل پروفایل";
}

<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card shadow-sm">
            <div class="card-header bg-success text-white">
                <h4 class="mb-0"><i class="fas fa-user-check me-2"></i>@ViewBag.Title</h4>
                <p class="mb-0">لطفاً اطلاعات خود را وارد کنید تا ثبت‌نام نهایی شود.</p>
            </div>
            <div class="card-body">
                @using (Html.BeginForm("CompleteRegistration", "Account", new { ReturnUrl = ViewBag.ReturnUrl }, FormMethod.Post, new { id = "complete-reg-form", role = "form" }))
                {
                    @Html.AntiForgeryToken()
                    @Html.ValidationSummary(true, "", new { @class = "text-danger" })

                    <div class="row g-3">
                        <div class="col-md-6">
                            @Html.LabelFor(model => model.PhoneNumber, new { @class = "form-label" })
                            @Html.TextBoxFor(model => model.PhoneNumber, new { @class = "form-control", @readonly = "readonly" })
                            @Html.HiddenFor(model => model.PhoneNumber) <!-- ارسال به سرور -->
                            @Html.ValidationMessageFor(model => model.PhoneNumber, "", new { @class = "text-danger" })
                        </div>



                        <div class="col-md-6">
                            @Html.LabelFor(model => model.NationalCode, new { @class = "form-label" })
                            @Html.EditorFor(model => model.NationalCode, new { htmlAttributes = new { @class = "form-control", placeholder = "کد ملی ۱۰ رقمی" } })
                            @Html.ValidationMessageFor(model => model.NationalCode, "", new { @class = "text-danger" })
                        </div>

                        <div class="col-md-6">
                            @Html.LabelFor(model => model.FirstName, new { @class = "form-label" })
                            @Html.EditorFor(model => model.FirstName, new { htmlAttributes = new { @class = "form-control", placeholder = "نام" } })
                            @Html.ValidationMessageFor(model => model.FirstName, "", new { @class = "text-danger" })
                        </div>

                        <div class="col-md-6">
                            @Html.LabelFor(model => model.LastName, new { @class = "form-label" })
                            @Html.EditorFor(model => model.LastName, new { htmlAttributes = new { @class = "form-control", placeholder = "نام خانوادگی" } })
                            @Html.ValidationMessageFor(model => model.LastName, "", new { @class = "text-danger" })
                        </div>

                        <div class="col-md-6">
                            @Html.LabelFor(model => model.BirthDatePersian, new { @class = "form-label" })
                            @Html.TextBoxFor(model => model.BirthDatePersian, new { @class = "form-control", id = "birthdate-picker", autocomplete = "off" })
                            @Html.ValidationMessageFor(model => model.BirthDatePersian, "", new { @class = "text-danger" })
                        </div>

                        <div class="col-12">
                            @Html.LabelFor(model => model.Address, new { @class = "form-label" })
                            @Html.TextAreaFor(model => model.Address, 4, 0, new { @class = "form-control", placeholder = "آدرس محل سکونت" })
                            @Html.ValidationMessageFor(model => model.Address, "", new { @class = "text-danger" })
                        </div>
                    </div>

                    <hr class="my-4">

                    <div class="d-grid">
                        <button type="submit" id="submit-button" class="btn btn-lg btn-success">
                            <span id="submit-button-text">
                                <i class="fas fa-check-circle me-2"></i>ثبت‌نام نهایی
                            </span>
                            <span id="submit-button-spinner" class="spinner-border spinner-border-sm" style="display: none;"></span>
                        </button>
                    </div>
                }
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
    @Html.Partial("_ValidationToasts")

    <script type="text/javascript">
        $(document).ready(function () {
            // پیکربندی پیشرفته تقویم شمسی با فارسی‌سازی کامل
            $("#birthdate-picker").pDatepicker({
                format: 'YYYY/MM/DD',            // فرمت نمایش شمسی به کاربر
                autoClose: true,                 // بستن خودکار بعد از انتخاب
                initialValue: false,             // بدون مقدار اولیه
                observer: true,                  // برای کار با اعتبارسنجی MVC

                // اتصال به فیلد مخفی میلادی
                altFormat: 'YYYY-MM-DD',         // فرمت استاندارد میلادی برای ارسال به سرور

                // تنظیمات تقویم فارسی
                calendarSettings: {
                    persian: {
                        locale: 'fa',
                        leapYearMode: 'astronomical'
                    }
                },

                // تم و ظاهر
                theme: 'blue',                   // می‌توانید: default, blue, dark, red
                digits: 'persian',               // نمایش اعداد فارسی

                // متن‌ها و ترجمه کامل دکمه‌ها
                toolbox: {
                    todayBtn: {
                        enabled: true,
                        text: { fa: 'امروز' }
                    },
                    clearBtn: {
                        enabled: true,
                        text: { fa: 'پاک کردن' }
                    },
                    calendarSwitch: {
                        enabled: true,
                        format: 'YYYY'
                    }
                },

                // نام ماه‌ها و روزها
                calendar: {
                    persian: {
                        monthNames: [
                            'فروردین', 'اردیبهشت', 'خرداد',
                            'تیر', 'مرداد', 'شهریور',
                            'مهر', 'آبان', 'آذر',
                            'دی', 'بهمن', 'اسفند'
                        ],
                        dayNames: [
                            'شنبه', 'یک‌شنبه', 'دوشنبه',
                            'سه‌شنبه', 'چهارشنبه', 'پنج‌شنبه', 'جمعه'
                        ],
                        dayNamesShort: ['ش', 'ی', 'د', 'س', 'چ', 'پ', 'ج']
                    }
                },

                // متن‌های پیش‌فرض
                textArray: {
                    'fa': {
                        'today': 'امروز',
                        'yesterday': 'دیروز',
                        'lastWeek': 'هفته گذشته',
                        'lastMonth': 'ماه گذشته',
                        'lastYear': 'سال گذشته',
                        'clear': 'پاک کردن',
                        'close': 'بستن'
                    }
                }
            });

            // مدیریت وضعیت دکمه ارسال فرم
            $('#complete-reg-form').on('submit', function () {
                if ($(this).valid()) {
                    $('#submit-button').prop('disabled', true);
                    $('#submit-button-text').hide();
                    $('#submit-button-spinner').show();
                }
            });

            // بهبود نمایش خطاهای اعتبارسنجی
            $.validator.setDefaults({
                highlight: function (element) { $(element).addClass('is-invalid'); },
                unhighlight: function (element) { $(element).removeClass('is-invalid'); }
            });
        });
    </script>
}