@using ClinicApp.ViewModels.Reception
@using ClinicApp.Constants
@model PatientAccordionViewModel

<!-- بخش اطلاعات بیمار - آکاردئون -->
<div class="patient-accordion-section" id="patientAccordionSection">
    
    <!-- Header بخش -->
    <div class="section-header">
        <div class="section-title">
            <h5 class="mb-0">
                <i class="fas fa-user me-2"></i>
                اطلاعات هویتی بیمار
            </h5>
            <p class="section-subtitle mb-0">جستجو و ثبت اطلاعات کامل بیمار</p>
        </div>
        <div class="section-actions">
            <button type="button" class="btn btn-outline-primary btn-sm" id="searchPatientBtn">
                <i class="fas fa-search me-1"></i>
                <span class="btn-text">جستجو</span>
                <span class="btn-loading d-none">
                    <i class="fas fa-spinner fa-spin me-1"></i>
                    در حال جستجو...
                </span>
            </button>
            <button type="button" class="btn btn-outline-success btn-sm" id="savePatientBtn">
                <i class="fas fa-save me-1"></i>
                <span class="btn-text">ذخیره</span>
                <span class="btn-loading d-none">
                    <i class="fas fa-spinner fa-spin me-1"></i>
                    در حال ذخیره...
                </span>
            </button>
        </div>
    </div>

    <!-- محتوای بخش -->
    <div class="section-content">
        <!-- Error Handling Container -->
        <div class="alert-container d-none" id="patientErrorContainer">
            <div class="alert alert-danger alert-dismissible fade show" role="alert">
                <i class="fas fa-exclamation-triangle me-2"></i>
                <span class="error-message"></span>
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        </div>
        
        <!-- Success Notification Container -->
        <div class="alert-container d-none" id="patientSuccessContainer">
            <div class="alert alert-success alert-dismissible fade show" role="alert">
                <i class="fas fa-check-circle me-2"></i>
                <span class="success-message"></span>
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        </div>
        <!-- Layout بهینه: جستجو در بالا، فرم در پایین -->
        <div class="row">
            <!-- جستجوی بیمار - عرض کامل -->
            <div class="col-12">
                <div class="patient-search-card">
                    <div class="card-header">
                        <h6 class="card-title mb-0">
                            <i class="fas fa-search me-2"></i>
                            جستجوی بیمار
                        </h6>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-8">
                                <!-- فیلد کد ملی -->
                                <div class="form-group mb-3">
                                    <label class="form-label">
                                        <i class="fas fa-id-card me-1"></i>
                                        کد ملی <span class="text-danger">*</span>
                                    </label>
                                    <div class="input-group">
                                        @Html.TextBoxFor(m => m.NationalCode, new { 
                                            @class = "form-control", 
                                            id = "patientNationalCode",
                                            placeholder = "کد ملی 10 رقمی",
                                            maxlength = "10",
                                            data_validation = "national-code",
                                            data_required = "true"
                                        })
                                        <button class="btn btn-outline-primary" type="button" id="searchByNationalCodeBtn">
                                            <i class="fas fa-search"></i>
                                        </button>
                                    </div>
                                    <div class="invalid-feedback" id="nationalCodeError"></div>
                                    <div class="form-text">کد ملی 10 رقمی بیمار را وارد کنید</div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <!-- نتایج جستجو -->
                                <div class="search-results d-none" id="patientSearchResults">
                                    <div class="alert alert-info">
                                        <i class="fas fa-info-circle me-2"></i>
                                        <span id="searchResultMessage">در حال جستجو...</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- اطلاعات بیمار - Grid Layout بهینه -->
        <div class="row">
            <div class="col-12">
                <div class="patient-info-card">
                    <div class="card-header">
                        <h6 class="card-title mb-0">
                            <i class="fas fa-user-circle me-2"></i>
                            اطلاعات بیمار
                        </h6>
                    </div>
                    <div class="card-body">
                        <form id="patientInfoForm" class="patient-info-form">
                            @Html.AntiForgeryToken()
                            
                            <!-- فیلدهای اطلاعات هویتی - Grid 3 ستونی -->
                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fas fa-user me-1"></i>
                                    نام <span class="text-danger">*</span>
                                </label>
                                @Html.TextBoxFor(m => m.FirstName, new { 
                                    @class = "form-control", 
                                    id = "patientFirstName",
                                    placeholder = "نام بیمار",
                                    required = "required"
                                })
                            </div>

                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fas fa-user me-1"></i>
                                    نام خانوادگی <span class="text-danger">*</span>
                                </label>
                                @Html.TextBoxFor(m => m.LastName, new { 
                                    @class = "form-control", 
                                    id = "patientLastName",
                                    placeholder = "نام خانوادگی بیمار",
                                    required = "required"
                                })
                            </div>

                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fas fa-user me-1"></i>
                                    نام پدر
                                </label>
                                @Html.TextBoxFor(m => m.FatherName, new { 
                                    @class = "form-control", 
                                    id = "patientFatherName",
                                    placeholder = "نام پدر بیمار"
                                })
                            </div>

                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fas fa-calendar me-1"></i>
                                    تاریخ تولد
                                </label>
                                <input type="date" 
                                       class="form-control" 
                                       id="patientBirthDate" 
                                       name="BirthDate"
                                       value="@(Model.BirthDate?.ToString("yyyy-MM-dd"))">
                            </div>

                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fas fa-birthday-cake me-1"></i>
                                    سن
                                </label>
                                <input type="number" 
                                       class="form-control" 
                                       id="patientAge" 
                                       name="Age"
                                       placeholder="سن بیمار"
                                       readonly="readonly"
                                       value="@Model.Age">
                                <div class="form-text">سن به صورت خودکار محاسبه می‌شود</div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fas fa-venus-mars me-1"></i>
                                    جنسیت
                                </label>
                                @Html.DropDownListFor(m => m.Gender, new SelectList(new[] {
                                    new { Value = "", Text = "انتخاب کنید" },
                                    new { Value = "Male", Text = "مرد" },
                                    new { Value = "Female", Text = "زن" }
                                }, "Value", "Text", Model.Gender), new { @class = "form-select", id = "patientGender" })
                            </div>

                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fas fa-phone me-1"></i>
                                    شماره تلفن
                                </label>
                                <input type="tel" 
                                       class="form-control" 
                                       id="patientPhone" 
                                       name="PhoneNumber"
                                       placeholder="09123456789"
                                       value="@Model.PhoneNumber">
                            </div>

                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fas fa-map-marker-alt me-1"></i>
                                    آدرس
                                </label>
                                <textarea class="form-control" 
                                          id="patientAddress" 
                                          name="Address"
                                          rows="3"
                                          placeholder="آدرس کامل بیمار">@Model.Address</textarea>
                            </div>

                            <!-- فیلد خالی برای تکمیل Grid -->
                            <div class="form-group">
                                <!-- فیلد خالی برای حفظ ساختار Grid -->
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- وضعیت بخش -->
        <div class="section-status">
            <div class="status-indicators">
                <div class="status-item">
                    <span class="status-icon">
                        <i class="fas fa-user @(Model.IsPatientFound ? "text-success" : "text-muted")"></i>
                    </span>
                    <span class="status-text">@(Model.IsPatientFound ? "بیمار یافت شد" : "بیمار جدید")</span>
                </div>
                <div class="status-item">
                    <span class="status-icon">
                        <i class="fas fa-check-circle @(Model.IsValid ? "text-success" : "text-muted")"></i>
                    </span>
                    <span class="status-text">@(Model.IsValid ? "اطلاعات کامل" : "اطلاعات ناقص")</span>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- CSS moved to centralized file: Content/css/reception/reception-accordion.css -->

<!-- JavaScript moved to centralized module -->
