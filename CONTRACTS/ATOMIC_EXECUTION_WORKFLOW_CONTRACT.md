# โ๏ธ **ูุฑุงุฑุฏุงุฏ ุฑููุฏ ุงุฌุฑุง ุงุชูฺฉ (Atomic Execution Workflow Contract) - ClinicApp**

## ๐ฏ **ูุฏู:**
ุงู ูุฑุงุฑุฏุงุฏ ุดุงูู ุฑููุฏ ุงุฌุจุงุฑ ุจุฑุง ุงุฌุฑุง ุชุบุฑุงุช ุจูโุตูุฑุช ุงุชูฺฉุ ูุงุจูโุฑุฏฺฏุฑ ู ูุงุจูโุจุฑฺฏุดุช ุฏุฑ ูพุฑูฺู ClinicApp ุงุณุช.

---

## ๐จ **ูุงููู ุงุฌุจุงุฑ:**
**ุชูุงู ุชุบุฑุงุช ุจุงุฏ ุทุจู ุงู ุฑููุฏ 9 ูุฑุญููโุง ุงุฌุฑุง ุดููุฏ.**

---

## **ูุณุช B โ ุฑููุฏ ุงุฌุฑุง ุงุชูฺฉ (Atomic Execution Workflow)**

### **ฺฏุงู 0 โ ุดุฑูุน (Produce Plan Header)**

#### **0.1 ุชููุฏ ุดูุงุณู ุชุบุฑ ฺฉุชุง:**
```markdown
ุดูุงุณู: change-YYYYMMDD-xxxx
ูุซุงู: change-20250104-0001
```

#### **0.2 ุชุนู ููุน ฺฉุงุฑ:**
- `analyze` - ุชุญูู ู ุจุฑุฑุณ
- `propose` - ูพุดููุงุฏ ุชุบุฑ
- `patch` - ุงุนูุงู ุชุบุฑ

#### **0.3 ุงุฑุงุฆู ุฎูุงุตู ฺฉโุฎุท:**
```markdown
ูุฏู: [ุชูุถุญ ฺฉูุชุงู ูุฏู]
ุฏุงููู: [ูุงู/ูุงฺูู ููุฑุฏ ูุธุฑ]
```

### **ฺฏุงู 1 โ ุฌุณุชุฌู ููุง (Verify No-Duplicate)**

#### **1.1 ุฌุณุชุฌู ฺฉุงูู ุจุฑุง identifiers:**
```bash
# ุฌุณุชุฌููุง ุงุฌุจุงุฑ:
grep -r "class.*IdentifierName" .
grep -r "method.*IdentifierName" .
grep -r "view.*IdentifierName" .
grep -r "route.*IdentifierName" .
```

#### **1.2 ุงฺฏุฑ ูุดุงุจู ุงูุช ุดุฏ:**
- [ ] ููุฑุง ุจุฑฺฏุฑุฏ
- [ ] ูพุดููุงุฏ ุจุงุฒุงุณุชูุงุฏู/ุฑูฺฉุชูุฑ ุจุฏู
- [ ] ูุณุฑูุง ููุฌูุฏ ุฑุง ุฐฺฉุฑ ฺฉู

#### **1.3 ุงฺฏุฑ ูุดุงุจู ุงูุช ูุดุฏ:**
- [ ] ุฐฺฉุฑ ุตุฑุญ ุดูุงูุฏ
- [ ] ุชุงูโุงุณุชููพ ุฌุณุชุฌู
- [ ] ูุชุงุฌ grep/rg

### **ฺฏุงู 2 โ ูพุดููุงุฏ ฺฉูฺฺฉ ุงุชู**

#### **2.1 ุงฺฏุฑ ูุงุฒ ุจู ุงูุฒูุฏู ุงุณุช:**
- [ ] ูพุดููุงุฏ ฺฉูฺฺฉโุชุฑู ูุงุญุฏ ููฺฉู
- [ ] single method ุง small helper file
- [ ] single ViewModel property

#### **2.2 ูุฑ ูพุดููุงุฏ ุจุงุฏ ุดุงูู:**
- [ ] **ุนููุงู ฺฉูุชุงู**
- [ ] **ุชูุฌู ูู/ุจุฒูุณ**
- [ ] **ูุณุฑ ูุฏู ุฏูู** (ูุซุงู: `Areas/Admin/Controllers/DoctorDepartmentController.cs`)
- [ ] **diff_unified ฺฉุงูู** (ุญุฏุงฺฉุซุฑ 200 ุฎุท)
- [ ] **ูุฑูุฏ/ุฎุฑูุฌ ุชูุถุญ** (signature)
- [ ] **ุชุณุชโูุง ูพุดููุงุฏ** (ูุงู ู ูุฏู)

### **ฺฏุงู 3 โ ุงุฑุฒุงุจ ุฑุณฺฉ ู rollback**

#### **3.1 ูุฑ ูพุดููุงุฏ ุจุงุฏ ุดุงูู:**
- [ ] **ุจุฎุด ุฑุณฺฉ** (ฺฉูุชุงู)
- [ ] **ุฑุงู ุจุฑฺฏุดุช** ุดุงูู ูุฑูุงู git ููููู

#### **3.2 ูุซุงูโูุง rollback:**
```bash
# ุจุฑฺฏุดุช commit
git revert <commit-hash>

# ุจุฑฺฏุดุช ูุงู
git checkout HEAD~1 -- path/to/file

# ุจุฑฺฏุดุช branch
git checkout main
git branch -D feature-branch
```

### **ฺฏุงู 4 โ ุชุณุชโูุง ูุงุฒู (Required Tests)**

#### **4.1 ูพุดููุงุฏ ุญุฏุงูู:**
- [ ] **ฺฉ Unit Test** ุจุฑุง ููุทู ุฌุฏุฏ
- [ ] **ฺฉ Integration Test** ุจุฑุง ุณูุงุฑู ุงูุชูุง-ุจู-ุงูุชูุง

#### **4.2 ุงฺฏุฑ ุชุบุฑ DB ุฏุงุฑุฏ:**
- [ ] Migration test
- [ ] Seed test

#### **4.3 ูุฑูุช ุชุณุชโูุง:**
```csharp
[Test]
public void MethodName_Scenario_ExpectedResult()
{
    // Arrange
    // Act
    // Assert
}
```

### **ฺฏุงู 5 โ ุงุฑุงุฆู ุดูุงูุฏ ู ุฏุฑุฎูุงุณุช ุชุงุฏ ุงูุณุงู**

#### **5.1 ุฌูุนโฺฉุฑุฏู ููู ุดูุงูุฏ:**
- [ ] ูุชุงุฌ ุฌุณุชุฌู
- [ ] diff
- [ ] ุชุณุชโูุง
- [ ] ุฑุณฺฉ
- [ ] rollback

#### **5.2 ุงุฑุณุงู ูพุงู ุขูุงุฏู:**
```markdown
## ๐จ ุฏุฑุฎูุงุณุช ุชุงุฏ ุงูุณุงู

ุจุฑุง ุงุนูุงู change-id: change-YYYYMMDD-xxxx ูุทูุงู ุนุจุงุฑุช ุฒุฑ ุฑุง ุจููุณุฏ:

**I APPROVE APPLY**
```

### **ฺฏุงู 6 โ ูพุณ ุงุฒ ุชุฃุฏ (apply plan)**

#### **6.1 ูพุณ ุงุฒ ุฏุฑุงูุช ุนุจุงุฑุช ุชุฃุฏ:**
- [ ] ุชููุฏ ุฏูู ูุฌููุนู patch (unified diff)
- [ ] ุงุฑุงุฆู ุฏุณุชูุฑุงูุนููโูุง ฺฏุงูโุจูโฺฏุงู ุจุฑุง ุงุฌุฑุง

#### **6.2 ุฏุณุชูุฑุงูุนููโูุง ุงุฌุฑุง:**
```bash
# ุงุนูุงู patch
git apply change-YYYYMMDD-xxxx.patch

# commit ุชุบุฑุงุช
git add .
git commit -m "Apply change-YYYYMMDD-xxxx: [ุชูุถุญ ฺฉูุชุงู]"

# ุงุฌุงุฏ PR (ุงุฎุชุงุฑ)
git push origin feature-branch
```

#### **6.3 ูุญุฏูุฏุชโูุง AI:**
- [ ] AI ูุฑฺฏุฒ ุฎูุฏุด push ูฺฉูุฏ
- [ ] AI ูุฑฺฏุฒ merge ูฺฉูุฏ
- [ ] AI ุชููุง patch ู ุฏุณุชูุฑุงูุนูู ุชุญูู ุฏูุฏ

### **ฺฏุงู 7 โ ุงุนุชุจุงุฑุณูุฌ ูพุณ ุงุฒ ุงุนูุงู**

#### **7.1 ุฏุณุชูุฑุงูุนูู ุงุฌุฑุง ุชุณุชโูุง:**
```bash
# ุงุฌุฑุง Unit Tests
dotnet test --filter "Category=Unit"

# ุงุฌุฑุง Integration Tests
dotnet test --filter "Category=Integration"

# ุงุฌุฑุง Smoke Tests
dotnet test --filter "Category=Smoke"
```

#### **7.2 ฺฺฉโูุณุช ุงุนุชุจุงุฑุณูุฌ:**
- [ ] compile success
- [ ] unit tests passed
- [ ] integration tests passed
- [ ] smoke test on key flows

### **ฺฏุงู 8 โ ุจูโุฑูุฒุฑุณุงู ูพุงฺฏุงู ุฏุงูุด ู ูุณุชูุฏุงุช**

#### **8.1 ูพุณ ุงุฒ ุงุนูุงู ู ุชุณุช ูููู:**
- [ ] ุชููุฏ entry ูุงุจู ุฐุฎุฑู ุฏุฑ KB

#### **8.2 KB entry ุจุงุฏ ุดุงูู:**
- [ ] ฺู ุชุบุฑ ฺฉุฑุฏ (change-id)
- [ ] ูุงูโูุง ู ูุณุฑูุง
- [ ] ุฎูุงุตู ุชุงุซุฑ ุจุฑ ูุนูุงุฑ
- [ ] ููููู ุฏุฑุฎูุงุณุช/ูพุงุณุฎ (ุจุฑุง API)
- [ ] ูุงู ุชุณุชโูุง ู ูุชุงุฌ

### **ฺฏุงู 9 โ ฺฏุฒุงุฑุด ููุง ู ูพุดููุงุฏ ฺฏุงู ุจุนุฏ**

#### **9.1 ฺฏุฒุงุฑุด 1-ูพุงุฑุงฺฏุฑุงู:**
- [ ] ูุชุฌู ุชุบุฑ
- [ ] ูพุดููุงุฏ ฺฏุงู ุจุนุฏ
- [ ] ุจูุจูุฏูุง ูุฑุชุจุท
- [ ] refactorูุง ุขูุฏู

---

## **๐ ููุงุนุฏ ุณุฎุช (Constraints โ ุงูุฒุงูโุขูุฑ)**

### **1. ูุญุฏูุฏุชโูุง ูุงู:**
- [ ] ุญุฏุงฺฉุซุฑ ูุงู ุฏุฑ ูุฑ ฺฏุงู: **1**
- [ ] ุญุฏุงฺฉุซุฑ ุฎุทูุท ูพฺ ุงุชู: **200 ุฎุท**

### **2. ูุฑูุช ูพฺ:**
- [ ] unified diff ุง ูุงู ฺฉุงูู (ุฏุฑ ูุงูุจ ฺฉุฏ)

### **3. ุงูุฒุงูุงุช ุฌุณุชุฌู:**
- [ ] ุงูุฒุงู ุจู ุงุฑุงุฆู search-evidence ุจุฑุง ูุฑ Identifier ุฌุฏุฏ

### **4. ุงูุฒุงูุงุช ุชุณุช:**
- [ ] ูุฑ ุชุบุฑ ุจุฏูู ุชุณุช ูพุดููุงุฏ ูพุฐุฑูุชู ูุณุช

### **5. ุชุงุฏ ุงูุณุงู:**
- [ ] ุนุจุงุฑุช ุชุฃุฏ: **"I APPROVE APPLY"**
- [ ] ููุท ูพุณ ุงุฒ ุงู ุนุจุงุฑุชุ ูพุดููุงุฏ patch ุจุฑุง ุงุฌุฑุง ุงุฑุงุฆู ูโุดูุฏ

### **6. ููููุนุชโูุง AI:**
- [ ] ููููุนุช ุฎูุฏฺฉุงุฑ push/merge/deploy ุชูุณุท AI

---

## **๐ ูุฑูุชโูุง ุงุณุชุงูุฏุงุฑุฏ**

### **ูุฑูุช ุดูุงุณู ุชุบุฑ:**
```markdown
change-YYYYMMDD-xxxx
ูุซุงู: change-20250104-0001
```

### **ูุฑูุช diff:**
```diff
--- a/path/to/file.cs
+++ b/path/to/file.cs
@@ -line,count +line,count @@
 context line
-old line
+new line
 context line
```

### **ูุฑูุช ุชุณุช:**
```csharp
[Test]
[Category("Unit")]
public void ClassName_MethodName_Scenario_ExpectedResult()
{
    // Arrange
    var sut = new ClassName();
    
    // Act
    var result = sut.MethodName(input);
    
    // Assert
    Assert.AreEqual(expected, result);
}
```

---

## **๐ซ ููููุนุชโูุง ูุทูู:**

### **1. ุชุบุฑุงุช ุบุฑุงุชูฺฉ:**
```markdown
โ ููููุน - ุชุบุฑุงุช ฺฏุณุชุฑุฏู ฺฉุฌุง
โ ููููุน - ุชุบุฑ ฺูุฏู ูุงู ููุฒูุงู
โ ููููุน - ุชุบุฑุงุช ุจุฏูู ุชุณุช
```

### **2. ุนุฏู ุฑุนุงุช ุฑููุฏ:**
```markdown
โ ููููุน - ุฑุฏ ุดุฏู ุงุฒ ูุฑุงุญู
โ ููููุน - ุนุฏู ุฌุณุชุฌู ฺฉุงูู
โ ููููุน - ุนุฏู ุงุฑุฒุงุจ ุฑุณฺฉ
```

### **3. ุฎูุฏฺฉุงุฑุณุงุฒ ุบุฑูุฌุงุฒ:**
```markdown
โ ููููุน - push ุฎูุฏฺฉุงุฑ
โ ููููุน - merge ุฎูุฏฺฉุงุฑ
โ ููููุน - deploy ุฎูุฏฺฉุงุฑ
```

---

## **โ ุงุณุชุงูุฏุงุฑุฏูุง ุงุฌุจุงุฑ:**

### **1. ุงุชูฺฉ ุจูุฏู:**
- ูุฑ ุชุบุฑ ุจุงุฏ ฺฉูฺฺฉ ู ูุณุชูู ุจุงุดุฏ
- ูุงุจู ุชุณุช ู ุจุฑฺฏุดุช ุจุงุดุฏ
- ุชุงุซุฑ ูุญุฏูุฏ ุฏุงุดุชู ุจุงุดุฏ

### **2. ูุงุจูโุฑุฏฺฏุฑ ุจูุฏู:**
- ุดูุงุณู ฺฉุชุง ุจุฑุง ูุฑ ุชุบุฑ
- ูุณุชูุฏุณุงุฒ ฺฉุงูู ูุฑุงุญู
- ุดูุงูุฏ ฺฉุงู ุจุฑุง ุชุตููโฺฏุฑ

### **3. ูุงุจูโุจุฑฺฏุดุช ุจูุฏู:**
- ุฑุงูโูุง ุจุฑฺฏุดุช ูุดุฎุต
- ุฏุณุชูุฑุงุช git ุขูุงุฏู
- ุชุณุชโูุง rollback

---

## **๐ ูุซุงู ุนูู:**

### **ูุฑูุฏ:**
```markdown
ฺฉุงุฑุจุฑ: "ุงุถุงูู ฺฉุฑุฏู ูุชุฏ ุฌุฏุฏ ุจู DoctorServiceCategoryService"
```

### **ุฎุฑูุฌ:**
```markdown
## ฺฏุงู 0 - ุดุฑูุน
ุดูุงุณู: change-20250104-0001
ููุน: propose
ูุฏู: ุงุถุงูู ฺฉุฑุฏู ูุชุฏ GetDoctorServiceCategoryByIdAsync

## ฺฏุงู 1 - ุฌุณุชุฌู ููุง
โ ูฺ ูุชุฏ ูุดุงุจู ุงูุช ูุดุฏ

## ฺฏุงู 2 - ูพุดููุงุฏ ฺฉูฺฺฉ ุงุชู
- ุนููุงู: ุงุถุงูู ฺฉุฑุฏู ูุชุฏ GetDoctorServiceCategoryByIdAsync
- ูุณุฑ: Services/ClinicAdmin/DoctorServiceCategoryService.cs
- diff: [200 ุฎุท diff]

## ฺฏุงู 3 - ุงุฑุฒุงุจ ุฑุณฺฉ
ุฑุณฺฉ: ฺฉู - ุงุถุงูู ฺฉุฑุฏู ูุชุฏ ุฌุฏุฏ
rollback: git checkout HEAD~1 -- Services/ClinicAdmin/DoctorServiceCategoryService.cs

## ฺฏุงู 4 - ุชุณุชโูุง ูุงุฒู
- Unit Test: GetDoctorServiceCategoryByIdAsync_ValidId_ReturnsServiceCategory
- Integration Test: DoctorServiceCategoryService_GetById_EndToEnd

## ฺฏุงู 5 - ุฏุฑุฎูุงุณุช ุชุงุฏ
๐จ ุจุฑุง ุงุนูุงู change-20250104-0001 ูุทูุงู ุนุจุงุฑุช ุฒุฑ ุฑุง ุจููุณุฏ:
**I APPROVE APPLY**
```

---

## **๐ ุจูโุฑูุฒุฑุณุงู ูุฑุงุฑุฏุงุฏ:**

ุงู ูุฑุงุฑุฏุงุฏ ุจุงุฏ ุฏุฑ ุตูุฑุช:
- ุชุบุฑ ุฏุฑ ุณุงุฎุชุงุฑ ูพุฑูฺู
- ุงุถุงูู ุดุฏู ุงุจุฒุงุฑูุง ุฌุฏุฏ
- ุดูุงุณุง ููุงุท ุถุนู ุฏุฑ ุฑููุฏ

ุจูโุฑูุฒุฑุณุงู ุดูุฏ.

---

**ูุณุฎู**: 1.0  
**ุชุงุฑุฎ ุงุฌุงุฏ**: 2025-01-04  
**ุขุฎุฑู ุจูโุฑูุฒุฑุณุงู**: 2025-01-04  
**ูุถุนุช**: ูุนุงู
