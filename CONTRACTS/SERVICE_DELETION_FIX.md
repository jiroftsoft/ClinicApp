# ๐ฅ Service Deletion Fix Guide
# ุฑุงูููุง ุฑูุน ูุดฺฉู ุญุฐู ุฎุฏูุช

## ๐ ูุดฺฉู ุดูุงุณุง ุดุฏู
ุฎุทุง `FOREIGN KEY constraint "FK_dbo.Services_dbo.AspNetUsers_DeletedByUserId"` ูุดุงู ูโุฏูุฏ ฺฉู:
- ุฏุฑุฎูุงุณุช AJAX ูููู ุงุณุช (status 200)
- ุงูุง ุณุฑูุฑ ููโุชูุงูุฏ `DeletedByUserId` ุฑุง ุฏุฑ ุฌุฏูู `Services` ุจูโุฑูุฒุฑุณุงู ฺฉูุฏ
- ฺูู ุดูุงุณู ฺฉุงุฑุจุฑ ุฏุฑ ุฌุฏูู `AspNetUsers` ูุฌูุฏ ูุฏุงุฑุฏ

## โ ุฑุงูโุญู ูพุงุฏูโุณุงุฒ ุดุฏู

### 1. ุจูุจูุฏ ูุชุฏ `GetValidUserIdForOperation()`
ุฏุฑ `ServiceManagementService.cs` ูุชุฏ ุฌุฏุฏ ุงุถุงูู ุดุฏู ฺฉู:
- ุงุจุชุฏุง ุงุฒ ฺฉุงุฑุจุฑ ุฌุงุฑ ุงุณุชูุงุฏู ูโฺฉูุฏ
- ุงฺฏุฑ ููุฌูุฏ ูุจูุฏุ ุงุฒ ฺฉุงุฑุจุฑ ุณุณุชู ุงุณุชูุงุฏู ูโฺฉูุฏ
- ุงฺฏุฑ ููุฌูุฏ ูุจูุฏุ ุงุฒ ฺฉุงุฑุจุฑ ุงุฏูู ุงุณุชูุงุฏู ูโฺฉูุฏ
- ุฏุฑ ููุงุชุ ุงุฒ ุดูุงุณู ูพุดโูุฑุถ ุงุณุชูุงุฏู ูโฺฉูุฏ

### 2. ุจูุจูุฏ ูุงฺฏโฺฏุฑ
- ูุงฺฏโูุง ุฏููโุชุฑ ุจุง ูพุดููุฏ `๐ฅ MEDICAL`
- ููุงุด ุดูุงุณู ฺฉุงุฑุจุฑ ูุนุชุจุฑ ุงูุชุฎุงุจ ุดุฏู
- ูุงฺฏโฺฏุฑ ุงุฒ ุชูุงู ูุฑุงุญู ุนููุงุช

### 3. ูุฏุฑุช ุฎุทุงูุง null
- ุงุณุชูุงุฏู ุงุฒ null-coalescing operator (`??`)
- ุจุฑุฑุณ null ุจุฑุง `_currentUserService.UserId`

## ๐งช ูุฑุงุญู ุชุณุช

### ูุฑุญูู 1: ุจุฑุฑุณ ูุฌูุฏ ฺฉุงุฑุจุฑุงู ุณุณุชู
```sql
-- ุจุฑุฑุณ ฺฉุงุฑุจุฑ ุณุณุชู
SELECT Id, UserName, FullName, IsActive, IsDeleted 
FROM AspNetUsers 
WHERE UserName = 'system' OR UserName = '3031945451';

-- ุจุฑุฑุณ ฺฉุงุฑุจุฑ ุงุฏูู
SELECT Id, UserName, FullName, IsActive, IsDeleted 
FROM AspNetUsers 
WHERE UserName = 'admin' OR UserName = '3020347998';
```

### ูุฑุญูู 2: ุงุฌุฑุง ุงุณฺฉุฑูพุช ุงุฌุงุฏ ฺฉุงุฑุจุฑ ุณุณุชู
```sql
-- ุงุฌุฑุง ูุงู Database/CreateSystemUser.sql
```

### ูุฑุญูู 3: ุชุณุช ุญุฐู ุฎุฏูุช
1. ุจู ุตูุญู `/Admin/Service?serviceCategoryId=X` ุจุฑูุฏ
2. ุฑู ุฏฺฉูู ุญุฐู ฺฉ ุฎุฏูุช ฺฉูฺฉ ฺฉูุฏ
3. ุฏุฑ Console ูุฑูุฑฺฏุฑ ูุงฺฏโูุง ุฑุง ุจุฑุฑุณ ฺฉูุฏ

### ูุฑุญูู 4: ุจุฑุฑุณ ูุงฺฏโูุง ุณุฑูุฑ
ูุงูโูุง ูุงฺฏ ุฑุง ุฏุฑ ูพูุดูโูุง ุฒุฑ ุจุฑุฑุณ ฺฉูุฏ:
- `App_Data/Logs/`
- `Logs/`
- Event Viewer (Windows)

## ๐ง ุงุจุฒุงุฑูุง ุฏุจุงฺฏ

### ุงุณุชูุงุฏู ุงุฒ ุงุจุฒุงุฑูุง JavaScript
ุฏุฑ Console ูุฑูุฑฺฏุฑ ุงุฌุฑุง ฺฉูุฏ:

```javascript
// ุฏุจุงฺฏ ฺฉุงูู ุญุฐู ุฎุฏูุช
debugServiceDeletion(YOUR_SERVICE_ID);

// ุจุฑุฑุณ ูุงฺฏโูุง ุณุฑูุฑ
checkServerLogs();

// ุชุณุช ุณุฑุน
quickTest();
```

### ุจุฑุฑุณ Anti-Forgery Token
```javascript
// ุจุฑุฑุณ ุชูฺฉู ุงููุช
checkAntiForgeryToken();
```

## ๐ ฺฺฉโูุณุช ุฑูุน ูุดฺฉู

- [ ] ฺฉุงุฑุจุฑ "system" ุฏุฑ ุฏุชุงุจุณ ููุฌูุฏ ุงุณุช
- [ ] ฺฉุงุฑุจุฑ "admin" ุฏุฑ ุฏุชุงุจุณ ููุฌูุฏ ุงุณุช
- [ ] `SystemUsers.SystemUserId` ููุฏุงุฑ ุตุญุญ ุฏุงุฑุฏ
- [ ] `SystemUsers.AdminUserId` ููุฏุงุฑ ุตุญุญ ุฏุงุฑุฏ
- [ ] Anti-Forgery Token ุฏุฑ ูุฑู ููุฌูุฏ ุงุณุช
- [ ] ูุงฺฏโูุง ุณุฑูุฑ ุฎุทุง Foreign Key ูุดุงู ููโุฏููุฏ
- [ ] ุนููุงุช ุญุฐู ูููู ุงุณุช

## ๐จ ูุดฺฉูุงุช ุงุญุชูุงู ุจุงูโูุงูุฏู

### 1. ุฎุทุง Vazirmatn Font
```
GET http://localhost:3560/Fonts/vazirmatn/Vazirmatn-*.woff2 net::ERR_ABORTED 404 (Not Found)
```
**ุฑุงูโุญู:** ูุงูโูุง ูููุช ุฏุฑ ูพูุดู `Content/Fonts/vazirmatn/` ููุฌูุฏ ูุณุชูุฏ.

### 2. ุฎุทุง Accessibility
```
Blocked aria-hidden on an element because its descendant retained focus
```
**ุฑุงูโุญู:** JavaScript ุจุฑุง ูุฏุฑุช `aria-hidden` ุฏุฑ modal ุงุถุงูู ุดุฏู.

## ๐ฏ ูุชุฌูโฺฏุฑ

ุจุง ูพุงุฏูโุณุงุฒ ุงู ุชุบุฑุงุช:
1. โ ูุดฺฉู Foreign Key constraint ุญู ุดุฏู
2. โ ูุงฺฏโฺฏุฑ ุจูุจูุฏ ุงูุชู
3. โ ูุฏุฑุช ุฎุทุงูุง null ุจูุชุฑ ุดุฏู
4. โ ุนููุงุช ุญุฐู ุฎุฏูุช ุจุงุฏ ูููู ุจุงุดุฏ

ุงฺฏุฑ ููฺูุงู ูุดฺฉู ุฏุงุฑุฏุ ูุงฺฏโูุง ุณุฑูุฑ ุฑุง ุจุฑุฑุณ ฺฉูุฏ ุชุง ุนูุช ุฏูู ูุดุฎุต ุดูุฏ.
