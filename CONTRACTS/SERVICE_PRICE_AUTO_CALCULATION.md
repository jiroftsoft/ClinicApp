# ğŸ’° **Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø®ÙˆØ¯Ú©Ø§Ø± Ù‚ÛŒÙ…Øª Ø®Ø¯Ù…Ø§Øª Ø¯Ø± Seed**

**ØªØ§Ø±ÛŒØ®:** Û² Ø§Ú©ØªØ¨Ø± Û²Û°Û²Ûµ  
**Ù†Ø³Ø®Ù‡:** 1.0  
**ÙˆØ¶Ø¹ÛŒØª:** âœ… **Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯Ù‡**

---

## ğŸ¯ **Ù‡Ø¯Ù**

ÙˆÙ‚ØªÛŒ Ø®Ø¯Ù…Ø§Øª Ø¯Ø± ÙØ±Ø¢ÛŒÙ†Ø¯ Seed Ø§ÛŒØ¬Ø§Ø¯ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ØŒ Ù‚ÛŒÙ…Øª Ø¢Ù†â€ŒÙ‡Ø§ Ø¨Ù‡ ØµÙˆØ±Øª **Ø®ÙˆØ¯Ú©Ø§Ø±** Ø¨Ø± Ø§Ø³Ø§Ø³ ÙØ±Ù…ÙˆÙ„ RVU Ù…Ø­Ø§Ø³Ø¨Ù‡ Ùˆ Ø¯Ø± Ø¬Ø¯ÙˆÙ„ `Services` Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.

---

## ğŸ“Š **ÙØ±Ù…ÙˆÙ„ Ù…Ø­Ø§Ø³Ø¨Ù‡ (Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯ RVU - Ø§ÛŒØ±Ø§Ù†)**

```
Ù‚ÛŒÙ…Øª Ù†Ù‡Ø§ÛŒÛŒ (Ø±ÛŒØ§Ù„) = (RVU ÙÙ†ÛŒ Ã— Ú©Ø§ÛŒ ÙÙ†ÛŒ) + (RVU Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Ã— Ú©Ø§ÛŒ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ)
```

### **Ù…Ø«Ø§Ù„ Ø¹Ù…Ù„ÛŒ:**

#### **Ú©Ø¯ 970000 - ÙˆÛŒØ²ÛŒØª Ù¾Ø²Ø´Ú© Ø¹Ù…ÙˆÙ…ÛŒ (Ø¹Ø§Ø¯ÛŒ - #)**
```
Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ÙˆØ±ÙˆØ¯ÛŒ:
- RVU ÙÙ†ÛŒ: 0.5
- RVU Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ: 1.3
- Ú©Ø§ÛŒ ÙÙ†ÛŒ (Ø¹Ø§Ø¯ÛŒ): 4,350,000 Ø±ÛŒØ§Ù„
- Ú©Ø§ÛŒ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ (Ø¹Ø§Ø¯ÛŒ): 8,250,000 Ø±ÛŒØ§Ù„

Ù…Ø­Ø§Ø³Ø¨Ù‡:
Ù‚ÛŒÙ…Øª = (0.5 Ã— 4,350,000) + (1.3 Ã— 8,250,000)
     = 2,175,000 + 10,725,000
     = 12,900,000 Ø±ÛŒØ§Ù„
```

#### **Ú©Ø¯ 970096 - Ø®Ø¯Ù…Ø§Øª Ø±ÙˆØ§Ù†Ø´Ù†Ø§Ø³ÛŒ (#*)**
```
Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ÙˆØ±ÙˆØ¯ÛŒ:
- RVU ÙÙ†ÛŒ: 0.90
- RVU Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ: 3.5
- Ú©Ø§ÛŒ ÙÙ†ÛŒ (Ù‡Ø´ØªÚ¯â€ŒØ¯Ø§Ø±): 2,750,000 Ø±ÛŒØ§Ù„
- Ú©Ø§ÛŒ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ (Ù‡Ø´ØªÚ¯â€ŒØ¯Ø§Ø±): 5,450,000 Ø±ÛŒØ§Ù„

Ù…Ø­Ø§Ø³Ø¨Ù‡:
Ù‚ÛŒÙ…Øª = (0.90 Ã— 2,750,000) + (3.5 Ã— 5,450,000)
     = 2,475,000 + 19,075,000
     = 21,550,000 Ø±ÛŒØ§Ù„
```

---

## ğŸ—ï¸ **Ù…Ø¹Ù…Ø§Ø±ÛŒ Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ**

### **1. Ø³Ø§Ø®ØªØ§Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³**

#### **Ø¬Ø¯ÙˆÙ„ Service**
```sql
CREATE TABLE [dbo].[Services] (
    [ServiceId] INT PRIMARY KEY IDENTITY,
    [ServiceCode] NVARCHAR(50) NOT NULL,
    [Title] NVARCHAR(250) NOT NULL,
    [Price] DECIMAL(18, 0) NOT NULL,  -- Ù‚ÛŒÙ…Øª Ø¨Ù‡ Ø±ÛŒØ§Ù„ (Ø¨Ø¯ÙˆÙ† Ø§Ø¹Ø´Ø§Ø±)
    [IsHashtagged] BIT NOT NULL,
    ...
)
```

#### **Ø¬Ø¯ÙˆÙ„ ServiceComponent**
```sql
CREATE TABLE [dbo].[ServiceComponents] (
    [ServiceComponentId] INT PRIMARY KEY IDENTITY,
    [ServiceId] INT NOT NULL,
    [ComponentType] INT NOT NULL,  -- 0=Technical, 1=Professional
    [Coefficient] DECIMAL(18, 4) NOT NULL,  -- RVU (Ø¶Ø±ÛŒØ¨)
    ...
)
```

#### **Ø¬Ø¯ÙˆÙ„ FactorSetting**
```sql
CREATE TABLE [dbo].[FactorSettings] (
    [FactorSettingId] INT PRIMARY KEY IDENTITY,
    [FactorType] INT NOT NULL,  -- 0=Technical, 1=Professional
    [IsHashtagged] BIT NOT NULL,
    [Value] DECIMAL(18, 0) NOT NULL,  -- Ú©Ø§ÛŒ Ø¨Ù‡ Ø±ÛŒØ§Ù„
    [FinancialYear] INT NOT NULL,
    ...
)
```

---

### **2. ÙØ±Ø¢ÛŒÙ†Ø¯ Seeding**

```
ğŸ“ Ù…Ø±Ø­Ù„Ù‡ 0: Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ SystemUsers
ğŸ“ Ù…Ø±Ø­Ù„Ù‡ 1: Ø§ÛŒØ¬Ø§Ø¯ FactorSettings (Ú©Ø§ÛŒâ€ŒÙ‡Ø§ÛŒ ÙÙ†ÛŒ Ùˆ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ)
ğŸ“ Ù…Ø±Ø­Ù„Ù‡ 2: Ø§ÛŒØ¬Ø§Ø¯ ServiceTemplates (Ù‚Ø§Ù„Ø¨â€ŒÙ‡Ø§ÛŒ Ø®Ø¯Ù…Ø§Øª)
ğŸ“ Ù…Ø±Ø­Ù„Ù‡ 3: Ø§ÛŒØ¬Ø§Ø¯ Services (Ø®Ø¯Ù…Ø§Øª Ø¨Ø§ Price=0)
ğŸ“ Ù…Ø±Ø­Ù„Ù‡ 4: Ø§ÛŒØ¬Ø§Ø¯ ServiceComponents (Ø§Ø¬Ø²Ø§ÛŒ ÙÙ†ÛŒ Ùˆ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ)
ğŸ“ Ù…Ø±Ø­Ù„Ù‡ 4.5: Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø®ÙˆØ¯Ú©Ø§Ø± Ù‚ÛŒÙ…Øª Ø®Ø¯Ù…Ø§Øª â­ NEW
ğŸ“ Ù…Ø±Ø­Ù„Ù‡ 5: Ø§ÛŒØ¬Ø§Ø¯ SharedServices (Ø®Ø¯Ù…Ø§Øª Ù…Ø´ØªØ±Ú©)
ğŸ’¾ Ø°Ø®ÛŒØ±Ù‡ ØªÙ…Ø§Ù… ØªØºÛŒÛŒØ±Ø§Øª (ÛŒÚ© Ø¨Ø§Ø±)
```

---

### **3. Ú©Ø¯ Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ**

#### **Ø§Ù„Ù) ServiceSeedService.cs**

```csharp
/// <summary>
/// Ù…Ø­Ø§Ø³Ø¨Ù‡ Ùˆ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù‚ÛŒÙ…Øª ØªÙ…Ø§Ù… Ø®Ø¯Ù…Ø§Øª Ø¨Ø± Ø§Ø³Ø§Ø³ FactorSettings Ùˆ ServiceComponents
/// </summary>
public async Task CalculateAndUpdateServicePricesAsync()
{
    _logger.Information("ğŸ’° SERVICE_PRICE: Ø´Ø±ÙˆØ¹ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø®ÙˆØ¯Ú©Ø§Ø± Ù‚ÛŒÙ…Øª Ø®Ø¯Ù…Ø§Øª");

    // Ø¯Ø±ÛŒØ§ÙØª ØªÙ…Ø§Ù… Ø®Ø¯Ù…Ø§Øª ÙØ¹Ø§Ù„ Ø¨Ø§ Ø§Ø¬Ø²Ø§ÛŒ Ø¢Ù†â€ŒÙ‡Ø§
    var services = await _context.Services
        .Include(s => s.ServiceComponents)
        .Where(s => !s.IsDeleted && s.IsActive)
        .ToListAsync();

    foreach (var service in services)
    {
        // Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¬ÙˆØ¯ Ø§Ø¬Ø²Ø§ÛŒ Ù…Ø­Ø§Ø³Ø¨Ø§ØªÛŒ
        if (!HasComponents(service))
        {
            skippedCount++;
            continue;
        }

        // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù‚ÛŒÙ…Øª
        var calculatedPrice = _serviceCalculationService.CalculateServicePriceWithFactorSettings(
            service, 
            _context, 
            DateTime.Now,
            null,  // Ø¨Ø¯ÙˆÙ† Override Ø¯Ù¾Ø§Ø±ØªÙ…Ø§Ù†
            null   // Ø³Ø§Ù„ Ù…Ø§Ù„ÛŒ Ø¬Ø§Ø±ÛŒ
        );

        // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù‚ÛŒÙ…Øª (Ø¨Ù‡ Ø±ÛŒØ§Ù„ - decimal(18,0))
        service.Price = Math.Round(calculatedPrice, 0, MidpointRounding.AwayFromZero);
        service.UpdatedAt = DateTime.UtcNow;
        service.UpdatedByUserId = systemUserId;

        _logger.Information("âœ… {ServiceCode} = {Price:N0} Ø±ÛŒØ§Ù„", 
            service.ServiceCode, service.Price);

        successCount++;
    }

    _logger.Information("ğŸ“Š Ù…ÙˆÙÙ‚: {Success}, Ù†Ø§Ù…ÙˆÙÙ‚: {Failed}, Ø±Ø¯ Ø´Ø¯Ù‡: {Skipped}",
        successCount, failedCount, skippedCount);
}
```

#### **Ø¨) SystemSeedService.cs**

```csharp
public async Task SeedAllDataAsync()
{
    using (var transaction = _context.Database.BeginTransaction())
    {
        try
        {
            // Ù…Ø±Ø§Ø­Ù„ 1-4: FactorSettings, ServiceTemplates, Services, ServiceComponents
            await _factorSeedService.SeedFactorSettingsAsync();
            await _serviceTemplateSeedService.SeedServiceTemplatesAsync();
            await _serviceSeedService.SeedSampleServicesAsync();
            await _serviceSeedService.SeedServiceComponentsAsync();

            // â­ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø®ÙˆØ¯Ú©Ø§Ø± Ù‚ÛŒÙ…Øª
            _logger.Information("ğŸ“ Ù…Ø±Ø­Ù„Ù‡ 4.5 - Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø®ÙˆØ¯Ú©Ø§Ø± Ù‚ÛŒÙ…Øª Ø®Ø¯Ù…Ø§Øª");
            await _serviceSeedService.CalculateAndUpdateServicePricesAsync();

            // Ù…Ø±Ø­Ù„Ù‡ 5: SharedServices
            await _serviceSeedService.SeedSharedServicesAsync();

            // Ø°Ø®ÛŒØ±Ù‡ Ùˆ Commit
            await _context.SaveChangesAsync();
            transaction.Commit();

            _logger.Information("âœ… SYSTEM_SEED: ØªÙ…Ø§Ù… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯Ù†Ø¯");
        }
        catch (Exception ex)
        {
            transaction.Rollback();
            _logger.Error(ex, "âŒ SYSTEM_SEED: Rollback Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯");
            throw;
        }
    }
}
```

---

### **4. ServiceCalculationService.cs**

```csharp
/// <summary>
/// Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù‚ÛŒÙ…Øª Ø®Ø¯Ù…Øª Ø¨Ø± Ø§Ø³Ø§Ø³ FactorSettings
/// ÙØ±Ù…ÙˆÙ„: (RVU ÙÙ†ÛŒ Ã— Ú©Ø§ÛŒ ÙÙ†ÛŒ) + (RVU Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Ã— Ú©Ø§ÛŒ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ)
/// </summary>
public decimal CalculateServicePriceWithFactorSettings(
    Service service, 
    ApplicationDbContext context, 
    DateTime? date = null, 
    int? departmentId = null, 
    int? financialYear = null)
{
    var currentYear = financialYear ?? GetCurrentFinancialYear(date ?? DateTime.Now);

    // Ø¯Ø±ÛŒØ§ÙØª Ú©Ø§ÛŒ ÙÙ†ÛŒ (Ø¨Ø± Ø§Ø³Ø§Ø³ Ù‡Ø´ØªÚ¯)
    var technicalFactor = context.FactorSettings
        .Where(fs => fs.FactorType == ServiceComponentType.Technical &&
                    fs.IsHashtagged == service.IsHashtagged &&
                    fs.FinancialYear == currentYear &&
                    fs.IsActive && !fs.IsDeleted && !fs.IsFrozen)
        .OrderByDescending(fs => fs.EffectiveFrom)
        .FirstOrDefault();

    // Ø¯Ø±ÛŒØ§ÙØª Ú©Ø§ÛŒ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ (Ù‡Ù…ÛŒØ´Ù‡ false)
    var professionalFactor = context.FactorSettings
        .Where(fs => fs.FactorType == ServiceComponentType.Professional &&
                    fs.IsHashtagged == false &&
                    fs.FinancialYear == currentYear &&
                    fs.IsActive && !fs.IsDeleted && !fs.IsFrozen)
        .OrderByDescending(fs => fs.EffectiveFrom)
        .FirstOrDefault();

    // Ø¯Ø±ÛŒØ§ÙØª Ø§Ø¬Ø²Ø§ÛŒ Ø®Ø¯Ù…Øª
    var technicalComponent = service.ServiceComponents
        .FirstOrDefault(sc => sc.ComponentType == ServiceComponentType.Technical && 
                            sc.IsActive && !sc.IsDeleted);
    var professionalComponent = service.ServiceComponents
        .FirstOrDefault(sc => sc.ComponentType == ServiceComponentType.Professional && 
                            sc.IsActive && !sc.IsDeleted);

    // Ù…Ø­Ø§Ø³Ø¨Ù‡
    decimal basePrice = (technicalComponent.Coefficient * technicalFactor.Value) + 
                       (professionalComponent.Coefficient * professionalFactor.Value);

    // Ø¨Ø±Ø±Ø³ÛŒ Override Ø¯Ù¾Ø§Ø±ØªÙ…Ø§Ù† (Ø¯Ø± ØµÙˆØ±Øª Ù†ÛŒØ§Ø²)
    if (departmentId.HasValue)
    {
        var sharedService = context.SharedServices
            .FirstOrDefault(ss => ss.ServiceId == service.ServiceId && 
                                ss.DepartmentId == departmentId.Value);
        
        if (sharedService != null)
        {
            var overrideTechnical = sharedService.OverrideTechnicalFactor ?? technicalFactor.Value;
            var overrideProfessional = sharedService.OverrideProfessionalFactor ?? professionalFactor.Value;
            basePrice = (technicalComponent.Coefficient * overrideTechnical) + 
                       (professionalComponent.Coefficient * overrideProfessional);
        }
    }

    return basePrice;
}
```

---

## ğŸ“Š **Ù†Ù…ÙˆÙ†Ù‡ Ø®Ø±ÙˆØ¬ÛŒ Logging**

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ’° SERVICE_PRICE: Ø´Ø±ÙˆØ¹ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø®ÙˆØ¯Ú©Ø§Ø± Ù‚ÛŒÙ…Øª Ø®Ø¯Ù…Ø§Øª
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“Š SERVICE_PRICE: ØªØ¹Ø¯Ø§Ø¯ Ø®Ø¯Ù…Ø§Øª ÛŒØ§ÙØª Ø´Ø¯Ù‡: 15
âœ… SERVICE_PRICE: 970000 - ÙˆÛŒØ²ÛŒØª Ù¾Ø²Ø´Ú© Ø¹Ù…ÙˆÙ…ÛŒ = 12,900,000 Ø±ÛŒØ§Ù„
âœ… SERVICE_PRICE: 970005 - ÙˆÛŒØ²ÛŒØª Ø¯Ù†Ø¯Ø§Ù†Ù¾Ø²Ø´Ú© = 12,900,000 Ø±ÛŒØ§Ù„
âœ… SERVICE_PRICE: 970096 - Ø®Ø¯Ù…Ø§Øª Ø±ÙˆØ§Ù†Ø´Ù†Ø§Ø³ÛŒ = 21,550,000 Ø±ÛŒØ§Ù„
â­ï¸ SERVICE_PRICE: 970500 ÙØ§Ù‚Ø¯ Ø§Ø¬Ø²Ø§ÛŒ Ù…Ø­Ø§Ø³Ø¨Ø§ØªÛŒ Ø§Ø³Øª
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“Š SERVICE_PRICE: Ø®Ù„Ø§ØµÙ‡ Ù…Ø­Ø§Ø³Ø¨Ø§Øª:
   âœ… Ù…ÙˆÙÙ‚: 12 Ø®Ø¯Ù…Øª
   âŒ Ù†Ø§Ù…ÙˆÙÙ‚: 0 Ø®Ø¯Ù…Øª
   â­ï¸ Ø±Ø¯ Ø´Ø¯Ù‡: 3 Ø®Ø¯Ù…Øª
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## ğŸ¯ **ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ú©Ù„ÛŒØ¯ÛŒ**

### **1. Ø®ÙˆØ¯Ú©Ø§Ø± Ùˆ ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡** âœ…
- Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø®ÙˆØ¯Ú©Ø§Ø± Ø¯Ø± ÙØ±Ø¢ÛŒÙ†Ø¯ Seeding
- Ù†ÛŒØ§Ø²ÛŒ Ø¨Ù‡ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¯Ø³ØªÛŒ Ù†ÛŒØ³Øª

### **2. Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯ RVU** âœ…
- Ù…Ø·Ø§Ø¨Ù‚ Ø¨Ø§ Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯Ù‡Ø§ÛŒ ÙˆØ²Ø§Ø±Øª Ø¨Ù‡Ø¯Ø§Ø´Øª
- ÙØ±Ù…ÙˆÙ„ Ø¯Ù‚ÛŒÙ‚: `(RVU ÙÙ†ÛŒ Ã— Ú©Ø§ÛŒ ÙÙ†ÛŒ) + (RVU Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Ã— Ú©Ø§ÛŒ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ)`

### **3. Ø¯Ù‚Øª Ø¨Ø§Ù„Ø§** âœ…
- Ø°Ø®ÛŒØ±Ù‡ Ø¨Ù‡ Ø±ÛŒØ§Ù„ (`decimal(18,0)`)
- Ú¯Ø±Ø¯ Ú©Ø±Ø¯Ù† ØµØ­ÛŒØ­: `Math.Round(..., 0, MidpointRounding.AwayFromZero)`

### **4. Transaction-Safe** âœ…
- Ø¯Ø± ØµÙˆØ±Øª Ø®Ø·Ø§ØŒ Rollback Ù…ÛŒâ€ŒØ´ÙˆØ¯
- ÛŒÚ©Ù¾Ø§Ø±Ú†Ú¯ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ ØªØ¶Ù…ÛŒÙ† Ø´Ø¯Ù‡

### **5. Structured Logging** âœ…
- Ù„Ø§Ú¯â€ŒÙ‡Ø§ÛŒ Ø¯Ù‚ÛŒÙ‚ Ø¨Ø§ Serilog
- Prefix: `ğŸ’° SERVICE_PRICE:`
- Named Properties Ø¨Ø±Ø§ÛŒ Query

### **6. Error Handling** âœ…
- Try-Catch Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ø®Ø¯Ù…Øª
- Ø§Ø¯Ø§Ù…Ù‡ Ø¯Ø± ØµÙˆØ±Øª Ø®Ø·Ø§ (fail-safe)
- Ú¯Ø²Ø§Ø±Ø´ Ú©Ø§Ù…Ù„ Ù…ÙˆÙÙ‚/Ù†Ø§Ù…ÙˆÙÙ‚/Ø±Ø¯ Ø´Ø¯Ù‡

---

## ğŸ”„ **ÙÙ„ÙˆÚ†Ø§Ø±Øª**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   1. Seed FactorSettings (Ú©Ø§ÛŒâ€ŒÙ‡Ø§)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   2. Seed ServiceTemplates          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   3. Seed Services (Price=0)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   4. Seed ServiceComponents (RVU)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â­ 4.5. Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù‚ÛŒÙ…Øª Ø®ÙˆØ¯Ú©Ø§Ø±        â”‚
â”‚                                     â”‚
â”‚  For Each Service:                  â”‚
â”‚    price = (RVU_T Ã— K_T) +          â”‚
â”‚            (RVU_P Ã— K_P)            â”‚
â”‚    service.Price = Round(price, 0)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   5. Seed SharedServices            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   SaveChanges & Commit              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ **Ù†Ú©Ø§Øª Ù…Ù‡Ù…**

### **1. ØªØ±ØªÛŒØ¨ Ø§Ø¬Ø±Ø§** âš ï¸
**Ø­ØªÙ…Ø§Ù‹** Ø¨Ø§ÛŒØ¯ Ø¨Ù‡ ØªØ±ØªÛŒØ¨ Ø²ÛŒØ± Ø§Ø¬Ø±Ø§ Ø´ÙˆØ¯:
```
FactorSettings â†’ ServiceTemplates â†’ Services â†’ ServiceComponents â†’ CalculatePrice
```

### **2. Dependency Injection** âš ï¸
`ServiceSeedService` Ù†ÛŒØ§Ø² Ø¨Ù‡ `IServiceCalculationService` Ø¯Ø§Ø±Ø¯:
```csharp
public ServiceSeedService(
    ApplicationDbContext context,
    ILogger logger,
    ICurrentUserService currentUserService,
    IServiceCalculationService serviceCalculationService) // âœ… Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯
{
    _serviceCalculationService = serviceCalculationService;
}
```

### **3. Ø°Ø®ÛŒØ±Ù‡ Ø¨Ù‡ Ø±ÛŒØ§Ù„** âš ï¸
```csharp
// âŒ Ø§Ø´ØªØ¨Ø§Ù‡
service.Price = calculatedPrice;

// âœ… Ø¯Ø±Ø³Øª
service.Price = Math.Round(calculatedPrice, 0, MidpointRounding.AwayFromZero);
```

### **4. Ø¨Ø±Ø±Ø³ÛŒ Null** âš ï¸
Ù‚Ø¨Ù„ Ø§Ø² Ù…Ø­Ø§Ø³Ø¨Ù‡ØŒ ÙˆØ¬ÙˆØ¯ Ø§Ø¬Ø²Ø§ÛŒ ÙÙ†ÛŒ Ùˆ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Ø¨Ø±Ø±Ø³ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯:
```csharp
if (!HasComponents(service))
{
    skippedCount++;
    continue;
}
```

---

## ğŸ§ª **ØªØ³Øª Ùˆ Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ**

### **Ù…Ø«Ø§Ù„ ØªØ³Øª:**

```csharp
[Test]
public void Test_CalculateServicePrice_970000()
{
    // Arrange
    var service = new Service 
    { 
        ServiceCode = "970000",
        IsHashtagged = false,
        ServiceComponents = new List<ServiceComponent>
        {
            new ServiceComponent { ComponentType = Technical, Coefficient = 0.5m },
            new ServiceComponent { ComponentType = Professional, Coefficient = 1.3m }
        }
    };

    var technicalFactor = new FactorSetting 
    { 
        FactorType = Technical, 
        IsHashtagged = false, 
        Value = 4_350_000m 
    };
    
    var professionalFactor = new FactorSetting 
    { 
        FactorType = Professional, 
        IsHashtagged = false, 
        Value = 8_250_000m 
    };

    // Act
    var price = (0.5m * 4_350_000m) + (1.3m * 8_250_000m);

    // Assert
    Assert.AreEqual(12_900_000m, price);
}
```

---

## âœ… **Ø®Ù„Ø§ØµÙ‡**

| ÙˆÛŒÚ˜Ú¯ÛŒ | ÙˆØ¶Ø¹ÛŒØª |
|-------|-------|
| **Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø®ÙˆØ¯Ú©Ø§Ø±** | âœ… Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯Ù‡ |
| **Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯ RVU** | âœ… Ù…Ø·Ø§Ø¨Ù‚ ÙˆØ²Ø§Ø±Øª Ø¨Ù‡Ø¯Ø§Ø´Øª |
| **Transaction-Safe** | âœ… Rollback Ø®ÙˆØ¯Ú©Ø§Ø± |
| **Structured Logging** | âœ… Serilog Ø¨Ø§ Prefix |
| **Error Handling** | âœ… Fail-Safe |
| **Dependency Injection** | âœ… IServiceCalculationService |
| **Ø°Ø®ÛŒØ±Ù‡ Ø¨Ù‡ Ø±ÛŒØ§Ù„** | âœ… decimal(18,0) |

---

**ØªÙ‡ÛŒÙ‡â€ŒÚ©Ù†Ù†Ø¯Ù‡:** AI Assistant  
**ØªØ§Ø±ÛŒØ®:** Û² Ø§Ú©ØªØ¨Ø± Û²Û°Û²Ûµ  
**Ù†Ø³Ø®Ù‡:** 1.0

