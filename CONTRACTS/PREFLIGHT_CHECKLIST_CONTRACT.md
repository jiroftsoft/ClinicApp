# 📋 **قرارداد چک‌لیست پیش‌پرواز (Preflight Checklist Contract) - ClinicApp**

## 🎯 **هدف:**
این قرارداد شامل چک‌لیست اجباری است که باید قبل از هر پیشنهادی یا تغییر در پروژه ClinicApp اجرا شود تا از تکرار خطاها و نقض قراردادها جلوگیری شود.

---

## 🚨 **قانون اجباری:**
**هیچ تغییری بدون اجرای کامل این چک‌لیست مجاز نیست.**

---

## **لیست A — چک‌لیست پیش‌پرواز (Preflight — باید قبل از هر اقدام اجرا شود)**

### **1. بارگذاری قراردادها و اصول**

#### **1.1 بارگذاری و خواندن ۱۵ بند قراردادی:**
- [ ] `AI_COMPLIANCE_CONTRACT.md` - 15 بند اصلی
- [ ] `DESIGN_PRINCIPLES_CONTRACT.md` - اصول طراحی
- [ ] `FormStandards.md` - استانداردهای فرم‌ها
- [ ] `ControllerStandards.md` - استانداردهای کنترلرها
- [ ] `DATATABLES_STANDARDS_CONTRACT.md` - استانداردهای DataTables
- [ ] سایر قراردادهای مرتبط

#### **1.2 اعلام خلاصه (۱-۲ جمله) از بندهایی که مرتبط با درخواست فعلی هستند:**
```markdown
## بندهای مرتبط:
- قانون 1: تغییرات اتمی - [توضیح کوتاه]
- قانون 2: بررسی قبل از ایجاد - [توضیح کوتاه]
- قانون 6: توقف و تایید - [توضیح کوتاه]
```

### **2. بارگذاری پایگاه دانش (Knowledge Base)**

#### **2.1 پیدا و خواندن آخرین خلاصه‌های:**
- [ ] مدل‌ها و روابط کلیدی
- [ ] ViewModelها
- [ ] Controllerها
- [ ] مسیرها (routes)
- [ ] Migrationها

#### **2.2 اگر پایگاه دانش موجود نیست:**
- [ ] فهرست‌برداری سریع از فایل‌های کلیدی
- [ ] اعلام اینکه KB خالی است
- [ ] تعیین اطلاعات مورد نیاز برای پر کردن KB

### **3. شناسایی محدوده دقیق درخواست**

#### **3.1 مشخص کردن دامنه:**
- [ ] یک اکشن؟
- [ ] یک ویو؟
- [ ] یک ماژول کامل؟
- [ ] کل سیستم؟

#### **3.2 اگر دامنه مشخص نیست:**
- [ ] درخواست تعیین دامنه از کاربر (بدون فرض)

### **4. جستجوی گسترده برای جلوگیری از تکرار**

#### **4.1 اجرای جستجوهای اجباری:**
```bash
# مثال‌های جستجو:
git grep -n "Identifier" || true
rg "Identifier" || true
```

#### **4.2 گزارش نتایج جستجو:**
- [ ] مسیر فایل
- [ ] شماره خط
- [ ] قطعه کد (snippet)

### **5. شناسایی وابستگی‌ها و تاثیرات**

#### **5.1 لیست فایل/کلاس/متدهای متاثر:**
- [ ] Controllers
- [ ] Services
- [ ] Repositories
- [ ] ViewModels
- [ ] Views
- [ ] Migrations
- [ ] Config files

### **6. بررسی schema و DbContext**

#### **6.1 چک ApplicationDbContext/Clinic.cs:**
- [ ] مدل‌های مرتبط
- [ ] مایگریشن‌های موجود

#### **6.2 اعلام نیاز به مایگریشن:**
- [ ] در صورت تغییر مدل

### **7. بررسی سطح دسترسی و امنیت**

#### **7.1 بررسی Authorization:**
- [ ] آیا اکشن نیاز به `[Authorize]` دارد؟
- [ ] آیا Policy نیاز به تغییر دارد؟

#### **7.2 بررسی داده‌های حساس:**
- [ ] آیا داده‌های PII درگیر هستند؟
- [ ] آیا نیاز به رمزنگاری است؟

### **8. جمع‌آوری شواهد و آماده‌سازی گزارش اولیه**

#### **8.1 خروجی باید شامل:**
- [ ] خلاصه دامنه
- [ ] نتایج جستجو (paths+snippets)
- [ ] وابستگی‌ها
- [ ] ریسک‌های اولیه

### **9. یادآوری بند «هیچ تغییر بدون تایید»**

#### **9.1 یادآوری صریح:**
```markdown
⚠️ **یادآوری مهم**: هیچ تغییری بدون عبارت تأیید "I APPROVE APPLY" اعمال نخواهد شد.
```

---

## **📊 فرمت گزارش چک‌لیست پیش‌پرواز**

### **گزارش باید شامل:**

```json
{
  "changeId": "change-YYYYMMDD-xxxx",
  "domain": "خلاصه دامنه",
  "relatedContracts": ["قانون 1", "قانون 2"],
  "searchResults": {
    "identifier": "نتایج جستجو",
    "dependencies": "وابستگی‌ها"
  },
  "risks": ["ریسک 1", "ریسک 2"],
  "securityCheck": "وضعیت امنیت",
  "status": "آماده برای اقدام | نیاز به بررسی بیشتر"
}
```

---

## **🚫 ممنوعیت‌های مطلق:**

### **1. عدم اجرای چک‌لیست:**
```markdown
❌ ممنوع - هرگز بدون اجرای کامل چک‌لیست پیش‌پرواز اقدام نکنید
```

### **2. فرض کردن اطلاعات:**
```markdown
❌ ممنوع - هرگز اطلاعات را فرض نکنید، همیشه جستجو کنید
```

### **3. نادیده گیری وابستگی‌ها:**
```markdown
❌ ممنوع - هرگز وابستگی‌ها را نادیده نگیرید
```

---

## **✅ استانداردهای اجباری:**

### **1. جستجوی کامل:**
- حداقل 3 جستجوی مختلف برای هر identifier
- استفاده از `git grep` و `rg` (ripgrep)
- گزارش کامل نتایج

### **2. مستندسازی:**
- تمام مراحل باید مستند شوند
- نتایج جستجو باید ذخیره شوند
- ریسک‌ها باید شناسایی شوند

### **3. تایید انسانی:**
- هیچ تغییری بدون تایید صریح کاربر
- عبارت تایید: "I APPROVE APPLY"

---

## **📝 مثال عملی:**

### **ورودی:**
```markdown
کاربر: "اضافه کردن اکشن جدید به DoctorServiceCategoryController"
```

### **خروجی:**
```markdown
## گزارش چک‌لیست پیش‌پرواز

### دامنه: اضافه کردن اکشن جدید
### بندهای مرتبط: قانون 1 (تغییرات اتمی), قانون 2 (بررسی قبل از ایجاد)
### نتایج جستجو: 0 مورد مشابه یافت شد
### وابستگی‌ها: Controller, Service, Repository
### ریسک: کم - اضافه کردن متد جدید
### وضعیت: آماده برای اقدام

⚠️ هیچ تغییری بدون "I APPROVE APPLY" اعمال نخواهد شد.
```

---

## **📊 چک‌لیست ویژه DataTables:**

### **قبل از پیاده‌سازی DataTables:**
- [ ] بررسی قرارداد `DATATABLES_STANDARDS_CONTRACT.md`
- [ ] طراحی ViewModel با computed properties
- [ ] تنظیم AntiForgeryToken در View
- [ ] طراحی JavaScript با data-* attributes

### **بعد از پیاده‌سازی DataTables:**
- [ ] تست JSON response با حروف کوچک (`draw`, `data`, `recordsTotal`)
- [ ] تست Error handling
- [ ] تست AntiForgeryToken
- [ ] تست Column mapping
- [ ] تست Performance

### **خطاهای رایج DataTables:**
- [ ] `Cannot read properties of undefined (reading 'length')` → ساختار JSON نادرست
- [ ] `DataTables warning: Ajax error` → مشکل در AntiForgeryToken
- [ ] `TypeError: Cannot read properties of undefined` → Property names با حروف بزرگ

---

## **🔄 به‌روزرسانی قرارداد:**

این قرارداد باید در صورت:
- اضافه شدن قراردادهای جدید
- تغییر در ساختار پروژه
- شناسایی نقاط ضعف جدید

به‌روزرسانی شود.

---

**نسخه**: 1.1  
**تاریخ ایجاد**: 2025-01-04  
**آخرین به‌روزرسانی**: 2025-01-15  
**وضعیت**: فعال
