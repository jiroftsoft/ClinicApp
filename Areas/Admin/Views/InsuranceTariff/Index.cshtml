@model ClinicApp.ViewModels.Insurance.InsuranceTariff.InsuranceTariffIndexPageViewModel
@{
    ViewBag.Title = "Ù…Ø¯ÛŒØ±ÛŒØª ØªØ¹Ø±ÙÙ‡â€ŒÙ‡Ø§ÛŒ Ø¨ÛŒÙ…Ù‡";
    Layout = "~/Areas/Admin/Views/Shared/_AdminLayout.cshtml";
}

<div class="container-fluid">
    <!-- Header Section -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1 class="h3 mb-0">
                        <i class="fas fa-money-bill-wave text-primary"></i>
                        Ù…Ø¯ÛŒØ±ÛŒØª ØªØ¹Ø±ÙÙ‡â€ŒÙ‡Ø§ÛŒ Ø¨ÛŒÙ…Ù‡
                    </h1>
                    <p class="text-muted mb-0">Ù…Ø¯ÛŒØ±ÛŒØª ØªØ¹Ø±ÙÙ‡â€ŒÙ‡Ø§ÛŒ Ø®Ø§Øµ Ø®Ø¯Ù…Ø§Øª Ø¨Ø±Ø§ÛŒ Ø·Ø±Ø­â€ŒÙ‡Ø§ÛŒ Ø¨ÛŒÙ…Ù‡</p>
                </div>
                <div>
                    <a href="@Url.Action("Create")" class="btn btn-primary">
                        <i class="fas fa-plus"></i>
                        ØªØ¹Ø±ÙÙ‡ Ø¬Ø¯ÛŒØ¯
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Statistics Section -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-chart-bar"></i>
                        Ø¢Ù…Ø§Ø± Ú©Ù„ÛŒ
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3">
                            <div class="card bg-primary text-white">
                                <div class="card-body text-center">
                                    <h3 class="card-title">@Model.Statistics.TotalTariffs</h3>
                                    <p class="card-text">Ú©Ù„ ØªØ¹Ø±ÙÙ‡â€ŒÙ‡Ø§ÛŒ Ø¨ÛŒÙ…Ù‡</p>
                                    <i class="fas fa-money-bill-wave fa-2x"></i>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card bg-success text-white">
                                <div class="card-body text-center">
                                    <h3 class="card-title">@Model.Statistics.TariffsWithCustomPrice</h3>
                                    <p class="card-text">ØªØ¹Ø±ÙÙ‡â€ŒÙ‡Ø§ÛŒ Ø¨Ø§ Ù‚ÛŒÙ…Øª Ø®Ø§Øµ</p>
                                    <i class="fas fa-tag fa-2x"></i>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card bg-warning text-white">
                                <div class="card-body text-center">
                                    <h3 class="card-title">@Model.Statistics.TariffsWithCustomPatientShare</h3>
                                    <p class="card-text">ØªØ¹Ø±ÙÙ‡â€ŒÙ‡Ø§ÛŒ Ø¨Ø§ Ø³Ù‡Ù… Ø¨ÛŒÙ…Ø§Ø± Ø®Ø§Øµ</p>
                                    <i class="fas fa-user fa-2x"></i>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card bg-info text-white">
                                <div class="card-body text-center">
                                    <h3 class="card-title">@Model.Statistics.TariffsWithCustomInsurerShare</h3>
                                    <p class="card-text">ØªØ¹Ø±ÙÙ‡â€ŒÙ‡Ø§ÛŒ Ø¨Ø§ Ø³Ù‡Ù… Ø¨ÛŒÙ…Ù‡ Ø®Ø§Øµ</p>
                                    <i class="fas fa-shield-alt fa-2x"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Filter Section -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-filter"></i>
                        ÙÛŒÙ„ØªØ± Ùˆ Ø¬Ø³ØªØ¬Ùˆ
                    </h5>
                </div>
                <div class="card-body">
                    <form id="filterForm" method="post" action="@Url.Action("LoadTariffs")">
                        @Html.AntiForgeryToken()
                        <div class="row">
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label for="SearchTerm">
                                        <i class="fas fa-search text-primary"></i>
                                        Ø¬Ø³ØªØ¬Ùˆ
                                    </label>
                                    <div class="input-group">
                                        <input type="text" id="SearchTerm" name="SearchTerm" class="form-control" 
                                               value="@Model.Filter.SearchTerm" placeholder="Ø¬Ø³ØªØ¬Ùˆ Ø¯Ø± Ø®Ø¯Ù…Ø§ØªØŒ Ø·Ø±Ø­â€ŒÙ‡Ø§...">
                                        <div class="input-group-append">
                                            <span class="input-group-text">
                                                <i class="fas fa-search"></i>
                                            </span>
                                        </div>
                                    </div>
                                    <small class="form-text text-muted">
                                        <i class="fas fa-info-circle"></i>
                                        Ø­Ø¯Ø§Ù‚Ù„ 2 Ú©Ø§Ø±Ø§Ú©ØªØ± Ø¨Ø±Ø§ÛŒ Ø¬Ø³ØªØ¬Ùˆ
                                    </small>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label for="ProviderId">Ø§Ø±Ø§Ø¦Ù‡â€ŒØ¯Ù‡Ù†Ø¯Ù‡ Ø¨ÛŒÙ…Ù‡</label>
                                    @Html.DropDownList("InsuranceProviderId", Model.Filter.InsuranceProviderSelectList, 
                                        "Ù‡Ù…Ù‡ Ø§Ø±Ø§Ø¦Ù‡â€ŒØ¯Ù‡Ù†Ø¯Ú¯Ø§Ù†", new { @class = "form-control" })
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label for="PlanId">Ø·Ø±Ø­ Ø¨ÛŒÙ…Ù‡</label>
                                    @Html.DropDownList("InsurancePlanId", Model.Filter.InsurancePlanSelectList, 
                                        "Ù‡Ù…Ù‡ Ø·Ø±Ø­â€ŒÙ‡Ø§", new { @class = "form-control" })
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label for="ServiceId">Ø®Ø¯Ù…Øª</label>
                                    @Html.DropDownList("ServiceId", Model.Filter.ServiceSelectList, 
                                        "Ù‡Ù…Ù‡ Ø®Ø¯Ù…Ø§Øª", new { @class = "form-control" })
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-12">
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-search"></i>
                                    Ø¬Ø³ØªØ¬Ùˆ
                                </button>
                                <button type="button" id="clearFilter" class="btn btn-secondary">
                                    <i class="fas fa-times"></i>
                                    Ù¾Ø§Ú© Ú©Ø±Ø¯Ù†
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Results Section -->
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-list"></i>
                        Ù„ÛŒØ³Øª ØªØ¹Ø±ÙÙ‡â€ŒÙ‡Ø§ÛŒ Ø¨ÛŒÙ…Ù‡
                    </h5>
                </div>
                <div class="card-body">
                    <div id="tariffsList">
                        @Html.Partial("_InsuranceTariffListPartial", Model.Tariffs)
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Styles {
    <style>
        /* Loading states */
        .loading {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }
        
        @@keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        
        /* Enhanced table styling */
        .table-hover tbody tr:hover {
            background-color: rgba(0, 123, 255, 0.1);
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }
        
        /* Statistics cards animation */
        .card.bg-primary, .card.bg-success, .card.bg-warning, .card.bg-info {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .card.bg-primary:hover, .card.bg-success:hover, .card.bg-warning:hover, .card.bg-info:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        /* Filter section styling */
        .form-control:focus {
            border-color: #007bff;
            box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
        }
        
        /* Pagination styling */
        .pagination .page-link {
            border-radius: 50%;
            margin: 0 2px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .pagination .page-link:hover {
            background-color: #007bff;
            color: white;
            transform: scale(1.1);
        }
        
        .pagination .page-item.active .page-link {
            background-color: #007bff;
            border-color: #007bff;
        }
        
        /* Medical environment specific styling */
        .medical-badge {
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 500;
        }
        
        .medical-price {
            font-family: 'Courier New', monospace;
            font-weight: bold;
            color: #28a745;
        }
        
        .medical-percentage {
            font-family: 'Courier New', monospace;
            font-weight: bold;
        }
        
        /* Responsive improvements */
        @@media (max-width: 768px) {
            .table-responsive {
                font-size: 0.9em;
            }
            
            .btn-group .btn {
                padding: 0.25rem 0.5rem;
                font-size: 0.8em;
            }
        }
    </style>
}

@section Scripts {
    <script>
        $(document).ready(function() {
            // Search debouncing
            var searchTimeout;
            var searchDelay = 500; // 500ms delay
            
            // Real-time search with debouncing
            $('#SearchTerm').on('input', function() {
                clearTimeout(searchTimeout);
                var searchTerm = $(this).val();
                
                // Ù†Ù…Ø§ÛŒØ´ loading indicator
                showSearchLoadingIndicator();
                
                searchTimeout = setTimeout(function() {
                    if (searchTerm.length >= 2 || searchTerm.length === 0) {
                        loadTariffs();
                    } else {
                        hideSearchLoadingIndicator();
                    }
                }, searchDelay);
            });

            // Filter form submission
            $('#filterForm').on('submit', function(e) {
                e.preventDefault();
                loadTariffs();
            });

            // Clear filter
            $('#clearFilter').on('click', function() {
                $('#filterForm')[0].reset();
                clearTimeout(searchTimeout);
                loadTariffs();
            });

            // Ù†Ù…Ø§ÛŒØ´ loading indicator Ø¨Ø±Ø§ÛŒ Ø¬Ø³ØªØ¬Ùˆ
            function showSearchLoadingIndicator() {
                $('#SearchTerm').addClass('loading');
                $('#tariffsList').html('<div class="text-center py-4"><i class="fas fa-spinner fa-spin fa-2x text-primary"></i><br><small class="text-muted">Ø¯Ø± Ø­Ø§Ù„ Ø¬Ø³ØªØ¬Ùˆ...</small></div>');
            }

            // Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† loading indicator
            function hideSearchLoadingIndicator() {
                $('#SearchTerm').removeClass('loading');
            }

            // Load tariffs function
            function loadTariffs(pageNumber = 1) {
                console.log('ğŸ”„ Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ ØªØ¹Ø±ÙÙ‡â€ŒÙ‡Ø§...', 'Page:', pageNumber);
                
                // Ù†Ù…Ø§ÛŒØ´ loading indicator
                showTariffsLoadingIndicator();
                
                var formData = $('#filterForm').serialize();
                formData += '&PageNumber=' + pageNumber;
                console.log('ğŸ“‹ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ÙØ±Ù…:', formData);
                
                $.ajax({
                    url: '@Url.Action("LoadTariffs")',
                    type: 'POST',
                    data: formData,
                    success: function(response) {
                        console.log('ğŸ“Š Ù¾Ø§Ø³Ø® Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ ØªØ¹Ø±ÙÙ‡â€ŒÙ‡Ø§:', response);
                        $('#tariffsList').html(response);
                        console.log('âœ… ØªØ¹Ø±ÙÙ‡â€ŒÙ‡Ø§ Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ Ø´Ø¯Ù†Ø¯');
                        
                        // ØªÙ†Ø¸ÛŒÙ… event handlers Ø¨Ø±Ø§ÛŒ pagination
                        setupPaginationHandlers();
                        
                        // Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† loading indicator
                        hideTariffsLoadingIndicator();
                    },
                    error: function(xhr, status, error) {
                        console.error('âŒ Ø®Ø·Ø§ÛŒ AJAX Ø¯Ø± Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ ØªØ¹Ø±ÙÙ‡â€ŒÙ‡Ø§:', error);
                        console.error('Status:', status);
                        console.error('Response:', xhr.responseText);
                        
                        // Ù†Ù…Ø§ÛŒØ´ Ø®Ø·Ø§
                        showTariffsError();
                        hideTariffsLoadingIndicator();
                    }
                });
            }

            // Ù†Ù…Ø§ÛŒØ´ loading indicator Ø¨Ø±Ø§ÛŒ ØªØ¹Ø±ÙÙ‡â€ŒÙ‡Ø§
            function showTariffsLoadingIndicator() {
                $('#tariffsList').html('<div class="text-center py-5"><i class="fas fa-spinner fa-spin fa-3x text-primary"></i><br><h5 class="mt-3 text-muted">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ ØªØ¹Ø±ÙÙ‡â€ŒÙ‡Ø§...</h5><p class="text-muted">Ù„Ø·ÙØ§Ù‹ ØµØ¨Ø± Ú©Ù†ÛŒØ¯</p></div>');
            }

            // Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† loading indicator
            function hideTariffsLoadingIndicator() {
                // Loading indicator Ø¯Ø± loadTariffs success Ù…Ø®ÙÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯
            }

            // Ù†Ù…Ø§ÛŒØ´ Ø®Ø·Ø§ÛŒ ØªØ¹Ø±ÙÙ‡â€ŒÙ‡Ø§
            function showTariffsError() {
                $('#tariffsList').html('<div class="text-center py-5"><i class="fas fa-exclamation-triangle fa-3x text-danger"></i><br><h5 class="mt-3 text-danger">Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ ØªØ¹Ø±ÙÙ‡â€ŒÙ‡Ø§</h5><p class="text-muted">Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯</p><button class="btn btn-primary" onclick="loadTariffs()">ØªÙ„Ø§Ø´ Ù…Ø¬Ø¯Ø¯</button></div>');
            }

            // ØªÙ†Ø¸ÛŒÙ… event handlers Ø¨Ø±Ø§ÛŒ pagination
            function setupPaginationHandlers() {
                // Ø­Ø°Ù event handlers Ù‚Ø¨Ù„ÛŒ
                $('.pagination .page-link').off('click');
                
                // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† event handlers Ø¬Ø¯ÛŒØ¯
                $('.pagination .page-link').on('click', function(e) {
                    e.preventDefault();
                    var pageNumber = $(this).data('page');
                    if (pageNumber) {
                        loadTariffs(pageNumber);
                        
                        // Ø§Ø³Ú©Ø±ÙˆÙ„ Ø¨Ù‡ Ø¨Ø§Ù„Ø§ÛŒ Ù„ÛŒØ³Øª
                        $('html, body').animate({
                            scrollTop: $('#tariffsList').offset().top - 100
                        }, 500);
                    }
                });
            }

            // Cache Ø¨Ø±Ø§ÛŒ ÙÛŒÙ„ØªØ±Ù‡Ø§
            var filterCache = {
                providers: null,
                plans: null,
                services: null,
                lastUpdated: null,
                cacheTimeout: 5 * 60 * 1000 // 5 Ø¯Ù‚ÛŒÙ‚Ù‡
            };

            // Update filter dropdowns
            function updateFilterDropdowns() {
                console.log('ğŸ”„ Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ ÙÛŒÙ„ØªØ±Ù‡Ø§...');
                
                // Ø¨Ø±Ø±Ø³ÛŒ cache
                if (isFilterCacheValid()) {
                    console.log('âœ… Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² cache ÙÛŒÙ„ØªØ±Ù‡Ø§');
                    loadFiltersFromCache();
                    return;
                }
                
                // Ù†Ù…Ø§ÛŒØ´ loading indicator
                showFilterLoadingIndicator();
                
                // Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ Ù…ÙˆØ§Ø²ÛŒ ÙÛŒÙ„ØªØ±Ù‡Ø§
                var providersPromise = loadInsuranceProviders();
                var plansPromise = loadInsurancePlans();
                var servicesPromise = loadServices();
                
                // Ø§Ù†ØªØ¸Ø§Ø± Ø¨Ø±Ø§ÛŒ ØªÚ©Ù…ÛŒÙ„ Ù‡Ù…Ù‡ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§
                Promise.all([providersPromise, plansPromise, servicesPromise])
                    .then(function(results) {
                        console.log('âœ… Ù‡Ù…Ù‡ ÙÛŒÙ„ØªØ±Ù‡Ø§ Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ Ø´Ø¯Ù†Ø¯');
                        hideFilterLoadingIndicator();
                        updateFilterCache(results);
                    })
                    .catch(function(error) {
                        console.error('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ ÙÛŒÙ„ØªØ±Ù‡Ø§:', error);
                        hideFilterLoadingIndicator();
                        showFilterError();
                    });
            }

            // Ø¨Ø±Ø±Ø³ÛŒ Ø§Ø¹ØªØ¨Ø§Ø± cache
            function isFilterCacheValid() {
                if (!filterCache.lastUpdated) return false;
                var now = new Date().getTime();
                return (now - filterCache.lastUpdated) < filterCache.cacheTimeout;
            }

            // Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ ÙÛŒÙ„ØªØ±Ù‡Ø§ Ø§Ø² cache
            function loadFiltersFromCache() {
                if (filterCache.providers) {
                    populateInsuranceProviders(filterCache.providers);
                }
                if (filterCache.plans) {
                    populateInsurancePlans(filterCache.plans);
                }
                if (filterCache.services) {
                    populateServices(filterCache.services);
                }
            }

            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ cache
            function updateFilterCache(results) {
                filterCache.providers = results[0];
                filterCache.plans = results[1];
                filterCache.services = results[2];
                filterCache.lastUpdated = new Date().getTime();
            }

            // Ù†Ù…Ø§ÛŒØ´ loading indicator Ø¨Ø±Ø§ÛŒ ÙÛŒÙ„ØªØ±Ù‡Ø§
            function showFilterLoadingIndicator() {
                $('#InsuranceProviderId, #InsurancePlanId, #ServiceId').html('<option value="">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ...</option>').prop('disabled', true);
            }

            // Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† loading indicator
            function hideFilterLoadingIndicator() {
                $('#InsuranceProviderId, #InsurancePlanId, #ServiceId').prop('disabled', false);
            }

            // Ù†Ù…Ø§ÛŒØ´ Ø®Ø·Ø§ÛŒ ÙÛŒÙ„ØªØ±Ù‡Ø§
            function showFilterError() {
                $('#InsuranceProviderId, #InsurancePlanId, #ServiceId').html('<option value="">Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ</option>');
            }

            // Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ Ø§Ø±Ø§Ø¦Ù‡â€ŒØ¯Ù‡Ù†Ø¯Ú¯Ø§Ù† Ø¨ÛŒÙ…Ù‡
            function loadInsuranceProviders() {
                return new Promise(function(resolve, reject) {
                    $.ajax({
                        url: '@Url.Action("GetInsuranceProviders")',
                        type: 'GET',
                        dataType: 'json',
                        cache: true,
                        success: function(response) {
                            console.log('ğŸ“Š Ù¾Ø§Ø³Ø® Ø§Ø±Ø§Ø¦Ù‡â€ŒØ¯Ù‡Ù†Ø¯Ú¯Ø§Ù† Ø¨ÛŒÙ…Ù‡:', response);
                            console.log('ğŸ” Ø¨Ø±Ø±Ø³ÛŒ response.success:', response.success);
                            console.log('ğŸ” Ø¨Ø±Ø±Ø³ÛŒ response.data:', response.data);
                            console.log('ğŸ” Ø¨Ø±Ø±Ø³ÛŒ Array.isArray:', Array.isArray(response.data));
                            
                            // Ø¨Ø±Ø±Ø³ÛŒ Ø¯Ù‚ÛŒÙ‚ response
                            if (response && response.success === true && response.data && Array.isArray(response.data)) {
                                var options = '<option value="">Ù‡Ù…Ù‡ Ø§Ø±Ø§Ø¦Ù‡â€ŒØ¯Ù‡Ù†Ø¯Ú¯Ø§Ù†</option>';
                                $.each(response.data, function(index, item) {
                                    options += '<option value="' + item.id + '">' + item.name + '</option>';
                                });
                                
                                $('#InsuranceProviderId').html(options);
                                console.log('âœ… Ø§Ø±Ø§Ø¦Ù‡â€ŒØ¯Ù‡Ù†Ø¯Ú¯Ø§Ù† Ø¨ÛŒÙ…Ù‡ Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ Ø´Ø¯Ù†Ø¯:', response.data.length, 'Ù…ÙˆØ±Ø¯');
                                resolve(response.data);
                            } else {
                                console.error('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ Ø§Ø±Ø§Ø¦Ù‡â€ŒØ¯Ù‡Ù†Ø¯Ú¯Ø§Ù† Ø¨ÛŒÙ…Ù‡ - response:', response);
                                console.error('âŒ response.success:', response.success);
                                console.error('âŒ response.data:', response.data);
                                console.error('âŒ Array.isArray:', Array.isArray(response.data));
                                reject('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ Ø§Ø±Ø§Ø¦Ù‡â€ŒØ¯Ù‡Ù†Ø¯Ú¯Ø§Ù† Ø¨ÛŒÙ…Ù‡');
                            }
                        },
                        error: function(xhr, status, error) {
                            console.error('âŒ Ø®Ø·Ø§ÛŒ AJAX Ø¯Ø± Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ Ø§Ø±Ø§Ø¦Ù‡â€ŒØ¯Ù‡Ù†Ø¯Ú¯Ø§Ù† Ø¨ÛŒÙ…Ù‡:', error);
                            reject(error);
                        }
                    });
                });
            }

            // Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ Ø·Ø±Ø­â€ŒÙ‡Ø§ÛŒ Ø¨ÛŒÙ…Ù‡
            function loadInsurancePlans() {
                return new Promise(function(resolve, reject) {
                    $.ajax({
                        url: '@Url.Action("GetInsurancePlans")',
                        type: 'GET',
                        dataType: 'json',
                        cache: true,
                        success: function(response) {
                            console.log('ğŸ“Š Ù¾Ø§Ø³Ø® Ø·Ø±Ø­â€ŒÙ‡Ø§ÛŒ Ø¨ÛŒÙ…Ù‡:', response);
                            
                            // Ø¨Ø±Ø±Ø³ÛŒ Ø¯Ù‚ÛŒÙ‚ response
                            if (response && response.success === true && response.data && Array.isArray(response.data)) {
                                var options = '<option value="">Ù‡Ù…Ù‡ Ø·Ø±Ø­â€ŒÙ‡Ø§</option>';
                                $.each(response.data, function(index, item) {
                                    options += '<option value="' + item.id + '">' + item.name + '</option>';
                                });
                                
                                $('#InsurancePlanId').html(options);
                                console.log('âœ… Ø·Ø±Ø­â€ŒÙ‡Ø§ÛŒ Ø¨ÛŒÙ…Ù‡ Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ Ø´Ø¯Ù†Ø¯:', response.data.length, 'Ù…ÙˆØ±Ø¯');
                                resolve(response.data);
                            } else {
                                console.error('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ Ø·Ø±Ø­â€ŒÙ‡Ø§ÛŒ Ø¨ÛŒÙ…Ù‡ - response:', response);
                                console.error('âŒ response.success:', response.success);
                                console.error('âŒ response.data:', response.data);
                                console.error('âŒ Array.isArray:', Array.isArray(response.data));
                                reject('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ Ø·Ø±Ø­â€ŒÙ‡Ø§ÛŒ Ø¨ÛŒÙ…Ù‡');
                            }
                        },
                        error: function(xhr, status, error) {
                            console.error('âŒ Ø®Ø·Ø§ÛŒ AJAX Ø¯Ø± Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ Ø·Ø±Ø­â€ŒÙ‡Ø§ÛŒ Ø¨ÛŒÙ…Ù‡:', error);
                            reject(error);
                        }
                    });
                });
            }

            // Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ Ø®Ø¯Ù…Ø§Øª
            function loadServices() {
                return new Promise(function(resolve, reject) {
                    $.ajax({
                        url: '@Url.Action("GetServices")',
                        type: 'GET',
                        dataType: 'json',
                        data: { serviceCategoryId: 0 },
                        cache: true,
                        success: function(response) {
                            console.log('ğŸ“Š Ù¾Ø§Ø³Ø® Ø®Ø¯Ù…Ø§Øª:', response);
                            
                            // Ø¨Ø±Ø±Ø³ÛŒ Ø¯Ù‚ÛŒÙ‚ response
                            if (response && response.success === true && response.data && Array.isArray(response.data)) {
                                var options = '<option value="">Ù‡Ù…Ù‡ Ø®Ø¯Ù…Ø§Øª</option>';
                                $.each(response.data, function(index, item) {
                                    options += '<option value="' + item.id + '">' + item.name + '</option>';
                                });
                                
                                $('#ServiceId').html(options);
                                console.log('âœ… Ø®Ø¯Ù…Ø§Øª Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ Ø´Ø¯Ù†Ø¯:', response.data.length, 'Ù…ÙˆØ±Ø¯');
                                resolve(response.data);
                            } else {
                                console.error('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ Ø®Ø¯Ù…Ø§Øª - response:', response);
                                console.error('âŒ response.success:', response.success);
                                console.error('âŒ response.data:', response.data);
                                console.error('âŒ Array.isArray:', Array.isArray(response.data));
                                reject('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ Ø®Ø¯Ù…Ø§Øª');
                            }
                        },
                        error: function(xhr, status, error) {
                            console.error('âŒ Ø®Ø·Ø§ÛŒ AJAX Ø¯Ø± Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ Ø®Ø¯Ù…Ø§Øª:', error);
                            reject(error);
                        }
                    });
                });
            }

            // ØªØ§Ø¨Ø¹â€ŒÙ‡Ø§ÛŒ populate Ø¨Ø±Ø§ÛŒ cache
            function populateInsuranceProviders(data) {
                var options = '<option value="">Ù‡Ù…Ù‡ Ø§Ø±Ø§Ø¦Ù‡â€ŒØ¯Ù‡Ù†Ø¯Ú¯Ø§Ù†</option>';
                $.each(data, function(index, item) {
                    options += '<option value="' + item.id + '">' + item.name + '</option>';
                });
                $('#InsuranceProviderId').html(options);
            }

            function populateInsurancePlans(data) {
                var options = '<option value="">Ù‡Ù…Ù‡ Ø·Ø±Ø­â€ŒÙ‡Ø§</option>';
                $.each(data, function(index, item) {
                    options += '<option value="' + item.id + '">' + item.name + '</option>';
                });
                $('#InsurancePlanId').html(options);
            }

            function populateServices(data) {
                var options = '<option value="">Ù‡Ù…Ù‡ Ø®Ø¯Ù…Ø§Øª</option>';
                $.each(data, function(index, item) {
                    options += '<option value="' + item.id + '">' + item.name + '</option>';
                });
                $('#ServiceId').html(options);
            }

            // Initialize filters and load data on page load
            updateFilterDropdowns();
            loadTariffs();
        });
    </script>
}
