@model ClinicApp.ViewModels.Insurance.BusinessRule.BusinessRuleCreateEditViewModel
@{
    ViewBag.Title = "حذف قانون کسب‌وکار";
    Layout = "~/Areas/Admin/Views/Shared/_AdminLayout.cshtml";
}

@section Styles {
    <style>
        .delete-confirmation {
            background: linear-gradient(135deg, #f8f9fa 0%, #e3f2fd 100%);
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .delete-header {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
            padding: 20px 30px;
            border-radius: 12px 12px 0 0;
            margin: -30px -30px 30px -30px;
        }
        
        .warning-box {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            border: 2px solid #ffc107;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 25px;
        }
        
        .rule-details {
            background: linear-gradient(135deg, #e8f5e8 0%, #c8e6c9 100%);
            border: 1px solid #4caf50;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 25px;
        }
        
        .detail-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(0,0,0,0.1);
        }
        
        .detail-row:last-child {
            border-bottom: none;
        }
        
        .detail-label {
            font-weight: 600;
            color: #2c3e50;
        }
        
        .detail-value {
            color: #495057;
        }
        
        .json-preview {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 10px;
        }
        
        .btn-delete {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            border: none;
            color: white;
            border-radius: 8px;
            font-weight: 600;
            padding: 12px 24px;
            transition: all 0.3s ease;
        }
        
        .btn-delete:hover {
            background: linear-gradient(135deg, #c82333 0%, #a71e2a 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(220, 53, 69, 0.3);
        }
        
        .btn-cancel {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
            border: none;
            color: white;
            border-radius: 8px;
            font-weight: 600;
            padding: 12px 24px;
            transition: all 0.3s ease;
        }
        
        .btn-cancel:hover {
            background: linear-gradient(135deg, #495057 0%, #343a40 100%);
            transform: translateY(-2px);
        }
        
        .impact-analysis {
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            border: 1px solid #dc3545;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 25px;
        }
        
        .impact-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .impact-item:last-child {
            margin-bottom: 0;
        }
        
        .impact-icon {
            margin-left: 10px;
            color: #dc3545;
        }
    </style>
}

<div class="container-fluid">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <div class="delete-confirmation">
                <!-- Header -->
                <div class="delete-header">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h4 class="mb-0">
                                <i class="fas fa-trash-alt"></i>
                                حذف قانون کسب‌وکار
                            </h4>
                            <p class="mb-0 mt-1">تأیید حذف قانون و بررسی تأثیرات</p>
                        </div>
                        <a href="@Url.Action("Index")" class="btn btn-light">
                            <i class="fas fa-arrow-right"></i>
                            بازگشت
                        </a>
                    </div>
                </div>

                <!-- Warning Box -->
                <div class="warning-box">
                    <h6 class="text-warning mb-3">
                        <i class="fas fa-exclamation-triangle"></i>
                        هشدار مهم
                    </h6>
                    <p class="mb-2">
                        <strong>آیا از حذف این قانون اطمینان دارید؟</strong>
                    </p>
                    <p class="mb-0 text-muted">
                        حذف این قانون ممکن است بر محاسبات بیمه تأثیر بگذارد. این عمل غیرقابل بازگشت است.
                    </p>
                </div>

                <!-- Rule Details -->
                <div class="rule-details">
                    <h6 class="text-success mb-3">
                        <i class="fas fa-info-circle"></i>
                        جزئیات قانون
                    </h6>
                    <div class="detail-row">
                        <span class="detail-label">شناسه قانون:</span>
                        <span class="detail-value">@Model.BusinessRuleId</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">نام قانون:</span>
                        <span class="detail-value">@Model.RuleName</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">نوع قانون:</span>
                        <span class="detail-value">@GetRuleTypeDisplayName(Model.RuleType)</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">اولویت:</span>
                        <span class="detail-value">@Model.Priority</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">وضعیت:</span>
                        <span class="detail-value">
                            <span class="badge @(Model.IsActive ? "badge-success" : "badge-danger")">
                                @(Model.IsActive ? "فعال" : "غیرفعال")
                            </span>
                        </span>
                    </div>
                    @if (!string.IsNullOrEmpty(Model.Description))
                    {
                        <div class="detail-row">
                            <span class="detail-label">توضیحات:</span>
                            <span class="detail-value">@Model.Description</span>
                        </div>
                    }
                </div>

                <!-- Impact Analysis -->
                <div class="impact-analysis">
                    <h6 class="text-danger mb-3">
                        <i class="fas fa-exclamation-circle"></i>
                        تأثیرات حذف قانون
                    </h6>
                    <div class="impact-item">
                        <i class="fas fa-calculator impact-icon"></i>
                        <span>محاسبات بیمه ممکن است تغییر کند</span>
                    </div>
                    <div class="impact-item">
                        <i class="fas fa-chart-line impact-icon"></i>
                        <span>گزارش‌های مالی ممکن است تأثیر بپذیرند</span>
                    </div>
                    <div class="impact-item">
                        <i class="fas fa-users impact-icon"></i>
                        <span>بیماران ممکن است با تغییرات مواجه شوند</span>
                    </div>
                    <div class="impact-item">
                        <i class="fas fa-history impact-icon"></i>
                        <span>تاریخچه محاسبات قبلی حفظ می‌شود</span>
                    </div>
                </div>

                <!-- JSON Preview -->
                @if (!string.IsNullOrEmpty(Model.Conditions) || !string.IsNullOrEmpty(Model.Actions))
                {
                    <div class="mb-4">
                        <h6 class="text-info mb-3">
                            <i class="fas fa-code"></i>
                            پیش‌نمایش JSON
                        </h6>
                        @if (!string.IsNullOrEmpty(Model.Conditions))
                        {
                            <div class="mb-3">
                                <strong>شرط قانون:</strong>
                                <div class="json-preview">@Model.Conditions</div>
                            </div>
                        }
                        @if (!string.IsNullOrEmpty(Model.Actions))
                        {
                            <div>
                                <strong>عمل قانون:</strong>
                                <div class="json-preview">@Model.Actions</div>
                            </div>
                        }
                    </div>
                }

                <!-- Action Buttons -->
                <div class="d-flex justify-content-between">
                    <a href="@Url.Action("Index")" class="btn btn-cancel">
                        <i class="fas fa-times"></i>
                        انصراف
                    </a>
                    
                    @using (Html.BeginForm("DeleteConfirmed", "BusinessRule", FormMethod.Post, new { @class = "d-inline" }))
                    {
                        @Html.AntiForgeryToken()
                        @Html.HiddenFor(m => m.BusinessRuleId)
                        
                        <button type="submit" class="btn btn-delete" onclick="return confirmDelete()">
                            <i class="fas fa-trash-alt"></i>
                            حذف قانون
                        </button>
                    }
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function confirmDelete() {
            const ruleName = '@Model.RuleName';
            const message = `آیا از حذف قانون "${ruleName}" اطمینان دارید؟\n\nاین عمل غیرقابل بازگشت است و ممکن است بر محاسبات بیمه تأثیر بگذارد.`;
            
            return confirm(message);
        }
        
        // نمایش هشدار قبل از خروج از صفحه
        window.addEventListener('beforeunload', function(e) {
            e.preventDefault();
            e.returnValue = 'تغییرات ذخیره نشده ممکن است از دست برود.';
        });
        
        // حذف هشدار بعد از ارسال فرم
        $('form').on('submit', function() {
            window.removeEventListener('beforeunload', arguments.callee);
        });
    </script>
}

@functions {
    public string GetRuleTypeDisplayName(ClinicApp.Models.Entities.Insurance.BusinessRuleType ruleType)
    {
        return ruleType switch
        {
            ClinicApp.Models.Entities.Insurance.BusinessRuleType.CoveragePercent => "درصد پوشش",
            ClinicApp.Models.Entities.Insurance.BusinessRuleType.Deductible => "فرانشیز",
            ClinicApp.Models.Entities.Insurance.BusinessRuleType.PaymentLimit => "سقف پرداخت",
            ClinicApp.Models.Entities.Insurance.BusinessRuleType.AgeBasedDiscount => "تخفیف سنی",
            ClinicApp.Models.Entities.Insurance.BusinessRuleType.GenderBasedDiscount => "تخفیف جنسیتی",
            ClinicApp.Models.Entities.Insurance.BusinessRuleType.ServiceBasedDiscount => "تخفیف خدمتی",
            ClinicApp.Models.Entities.Insurance.BusinessRuleType.InsuranceBasedDiscount => "تخفیف بیمه‌ای",
            ClinicApp.Models.Entities.Insurance.BusinessRuleType.CustomRule => "قانون سفارشی",
            _ => "نامشخص"
        };
    }
}
