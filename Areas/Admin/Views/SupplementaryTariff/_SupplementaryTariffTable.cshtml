@model ClinicApp.Interfaces.PagedResult<ClinicApp.ViewModels.Insurance.Supplementary.SupplementaryTariffIndexViewModel>

<div class="table-responsive">
    <table class="table table-hover supplementary-tariff-table">
        <thead class="table-dark">
            <tr>
                <th>شناسه</th>
                <th>نام خدمت</th>
                <th>طرح بیمه</th>
                <th>قیمت خدمت</th>
                <th>سهم بیمه پایه</th>
                <th>سهم باقی‌مانده بیمار</th>
                <th>پوشش تکمیلی</th>
                <th>سهم نهایی بیمار</th>
                <th>اولویت</th>
                <th>تاریخ شروع</th>
                <th>تاریخ پایان</th>
                <th>وضعیت</th>
                <th>عملیات</th>
            </tr>
        </thead>
        <tbody id="tariffsTableBody">
            @foreach (var item in Model.Items)
            {
                <tr data-tariff-id="@item.InsuranceTariffId">
                    <td>
                        <span class="badge badge-secondary">@item.InsuranceTariffId</span>
                    </td>
                    <td>
                        <div class="fw-bold">@item.ServiceTitle</div>
                        <small class="text-muted">@item.ServiceCode</small>
                    </td>
                    <td>
                        <div class="fw-bold">@item.InsurancePlanName</div>
                        <small class="text-muted">@item.InsuranceProviderName</small>
                    </td>
                    <td>
                        <span class="currency-format" dir="ltr">@(item.TariffPrice?.ToString("N0") ?? "0") تومان</span>
                    </td>
                    <td>
                        <span class="currency-format" dir="ltr">@(item.InsurerShare?.ToString("N0") ?? "0") تومان</span>
                        <small class="text-muted d-block">پوشش پایه</small>
                    </td>
                    <td>
                        <span class="currency-format" dir="ltr">@((item.TariffPrice - item.InsurerShare)?.ToString("N0") ?? "0") تومان</span>
                        <small class="text-muted d-block">باقی‌مانده</small>
                    </td>
                    <td>
                        <span class="currency-format" dir="ltr">@(item.SupplementaryCoveragePercent?.ToString("F1") ?? "0")%</span>
                        <small class="text-muted d-block">از باقی‌مانده</small>
                    </td>
                    <td>
                        <span class="currency-format" dir="ltr">@(item.PatientShare?.ToString("N0") ?? "0") تومان</span>
                        <small class="text-muted d-block">نهایی</small>
                    </td>
                    <td>
                        <span class="badge badge-info">@(item.Priority?.ToString() ?? "0")</span>
                    </td>
                    <td>
                        <span class="text-muted">@(item.StartDate?.ToString("yyyy/MM/dd") ?? "نامشخص")</span>
                    </td>
                    <td>
                        <span class="text-muted">@(item.EndDate?.ToString("yyyy/MM/dd") ?? "نامشخص")</span>
                    </td>
                    <td>
                        <span class="badge @item.StatusCssClass">@item.StatusText</span>
                    </td>
                    <td>
                        <div class="btn-group" role="group">
                            <a href="@Url.Action("Details", new { id = item.InsuranceTariffId })" 
                               class="btn btn-sm btn-outline-info" title="مشاهده جزئیات">
                                <i class="fas fa-eye"></i>
                            </a>
                            <a href="@Url.Action("Edit", new { id = item.InsuranceTariffId })" 
                               class="btn btn-sm btn-outline-warning" title="ویرایش">
                                <i class="fas fa-edit"></i>
                            </a>
                            <button type="button" class="btn btn-sm btn-outline-danger" 
                                    onclick="deleteTariff(@item.InsuranceTariffId)" title="حذف">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>

<style>
    .supplementary-tariff-table {
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }

    .supplementary-tariff-table thead th {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 15px 10px;
        font-weight: 600;
        text-align: center;
    }

    .supplementary-tariff-table tbody tr {
        transition: all 0.3s ease;
    }

    .supplementary-tariff-table tbody tr:hover {
        background-color: #f8f9fa;
        transform: scale(1.01);
    }

    .supplementary-tariff-table tbody td {
        padding: 15px 10px;
        vertical-align: middle;
        text-align: center;
        border-bottom: 1px solid #e9ecef;
    }

    .currency-format {
        font-family: 'Courier New', monospace;
        font-weight: bold;
    }

    .badge {
        padding: 5px 10px;
        border-radius: 15px;
        font-size: 0.75rem;
        font-weight: 500;
    }

    .badge-success {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        color: white;
    }

    .badge-danger {
        background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
        color: white;
    }

    .badge-warning {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        color: white;
    }

    .badge-secondary {
        background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
        color: white;
    }

    .badge-info {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
    }

    .btn-group .btn {
        margin: 0 2px;
        border-radius: 20px;
        transition: all 0.3s ease;
        min-width: 35px;
        height: 35px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
    }

    .btn-group .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }

    .btn-group .btn i {
        font-size: 14px;
    }

    .btn-outline-info {
        color: #17a2b8;
        border-color: #17a2b8;
    }

    .btn-outline-info:hover {
        background-color: #17a2b8;
        border-color: #17a2b8;
        color: white;
    }
</style>

<script>
    // حذف تعرفه با Anti-forgery Token
    function deleteTariff(tariffId) {
        if (confirm('آیا از حذف این تعرفه اطمینان دارید؟')) {
            // دریافت Anti-forgery Token
            var token = $('input[name="__RequestVerificationToken"]').val();
            
            $.ajax({
                url: '/Admin/SupplementaryTariff/DeleteTariff',
                type: 'POST',
                data: {
                    id: tariffId,
                    __RequestVerificationToken: token
                },
                success: function(response) {
                    if (response.success) {
                        // حذف ردیف از جدول
                        $('tr[data-tariff-id="' + tariffId + '"]').fadeOut(300, function() {
                            $(this).remove();
                        });
                        
                        // نمایش پیام موفقیت
                        if (typeof window.MedicalUI !== 'undefined') {
                            window.MedicalUI.showSuccess('تعرفه با موفقیت حذف شد');
                        }
                    } else {
                        if (typeof window.MedicalUI !== 'undefined') {
                            window.MedicalUI.showError('خطا در حذف تعرفه: ' + (response.message || 'خطای نامشخص'));
                        }
                    }
                },
                error: function(xhr, status, error) {
                    console.error('خطا در حذف تعرفه:', error);
                    if (typeof window.MedicalUI !== 'undefined') {
                        window.MedicalUI.showError('خطا در حذف تعرفه: ' + error);
                    }
                }
            });
        }
    }
</script>
