@using ClinicApp.ViewModels
@model ClinicApp.ViewModels.DepartmentDetailsViewModel
@{
    ViewBag.Title = "تأیید حذف دپارتمان";
    Layout = "~/Areas/Admin/Views/Shared/_AdminLayout.cshtml";
}

<!-- استایل‌های حیاتی برای عملکرد بالا (Inline برای کاهش درخواست‌ها) -->
<style type="text/css">
    /* استایل‌های حیاتی برای اولین رندر */
    .delete-container {
        max-width: 700px;
        margin: 0 auto;
    }

    .warning-box {
        background: #fff8f8;
        border: 1px solid #f5c6cb;
        border-radius: 4px;
        padding: 20px;
        margin-bottom: 25px;
        color: #721c24;
    }

    .warning-icon {
        font-size: 2.5rem;
        color: #dc3545;
        margin-bottom: 15px;
    }

    .department-info {
        background: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: 4px;
        padding: 20px;
        margin-bottom: 20px;
    }

    .info-row {
        display: flex;
        margin-bottom: 10px;
    }

    .info-label {
        flex: 0 0 120px;
        font-weight: bold;
        color: #495057;
    }

    .info-value {
        flex: 1;
    }

    .stats-section {
        display: flex;
        justify-content: space-between;
        margin: 20px 0;
        padding: 15px;
        background: #e9ecef;
        border-radius: 4px;
    }

    .stats-item {
        text-align: center;
    }

    .stats-value {
        font-size: 1.5rem;
        font-weight: bold;
        color: #007bff;
    }

    .stats-label {
        font-size: 0.9rem;
        color: #6c757d;
    }

    .confirmation-section {
        background: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: 4px;
        padding: 20px;
        margin-top: 25px;
    }

    .confirmation-input {
        margin: 15px 0;
    }

    .btn-delete {
        background: #dc3545;
        border-color: #dc3545;
        color: white;
        padding: 10px 20px;
        font-weight: bold;
        transition: all 0.2s;
    }

        .btn-delete:hover {
            background: #c82333;
            border-color: #bd2130;
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(220, 53, 69, 0.2);
        }

    .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(255, 255, 255, 0.8);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 1000;
    }

    .loading-spinner {
        width: 50px;
        height: 50px;
        border: 5px solid #e9ecef;
        border-top: 5px solid #dc3545;
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }

    @@keyframes spin {
        0% {
            transform: rotate(0deg);
        }

        100% {
            transform: rotate(360deg);
        }
    }

    /* بهینه‌سازی برای دستگاه‌های پزشکی */
    @@media (max-width: 768px) {
        .stats-section {
            flex-direction: column;
            gap: 15px;
        }

        .info-row {
            flex-direction: column;
        }

        .info-label {
            margin-bottom: 5px;
        }
    }

    /* برای دستگاه‌های پزشکی با نور کم */
    @@media (prefers-contrast: high) {
        .warning-box {
            border: 2px solid #dc3545;
        }

        .department-info {
            border: 2px solid #000;
        }
    }

    /* افکت‌های تعاملی برای محیط‌های پزشکی */
    .btn-delete {
        touch-action: manipulation;
    }

        .btn-delete:active {
            transform: scale(0.98);
        }

    /* استایل‌های خاص برای پزشکان فعال */
    .active-doctors-list {
        max-height: 200px;
        overflow-y: auto;
        border: 1px solid #e9ecef;
        border-radius: 4px;
        padding: 10px;
        margin-top: 10px;
    }

    .doctor-item {
        padding: 5px 0;
        border-bottom: 1px solid #f1f1f1;
    }

    /* استایل‌های خاص برای تقویم */
    .calendar-icon {
        margin-left: 5px;
        color: #007bff;
    }

    .audit-trail {
        background: #f8f9fa;
        border-left: 3px solid #007bff;
        padding: 15px;
        border-radius: 0 4px 4px 0;
        margin-top: 15px;
    }

    .audit-item {
        padding: 10px 0;
        border-bottom: 1px solid #e9ecef;
    }

    .audit-user {
        font-weight: 500;
        color: #212529;
    }

    .audit-time {
        font-size: 0.85rem;
        color: #6c757d;
        margin-left: 5px;
    }

    .audit-action {
        color: #007bff;
        font-weight: 500;
    }

    /* استایل‌های خاص برای چاپ */
    @@media print {
        body * {
            visibility: hidden;
        }

        .print-section, .print-section * {
            visibility: visible;
        }

        .print-section {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
        }

        .actions-bar, .no-print {
            display: none;
        }
    }

    /* استایل‌های خاص برای سیستم اضطراری */
    .emergency-warning {
        background: #fff3cd;
        border-left: 4px solid #ffc107;
        padding: 15px;
        margin: 20px 0;
        border-radius: 0 4px 4px 0;
    }

    /* استایل‌های خاص برای سیستم امنیتی */
    .security-note {
        background: #e2e3e5;
        border: 1px solid #d6d8db;
        border-radius: 4px;
        padding: 15px;
        margin-top: 20px;
        font-size: 0.9rem;
    }

    .security-note-title {
        font-weight: bold;
        color: #495057;
        margin-bottom: 5px;
    }

    /* استایل‌های خاص برای محیط‌های پزشکی */
    .medical-note {
        background: #e3f2fd;
        border: 1px solid #bbdefb;
        border-radius: 4px;
        padding: 15px;
        margin: 20px 0;
    }

    .medical-note-title {
        font-weight: bold;
        color: #0d47a1;
        margin-bottom: 8px;
    }

    .medical-note-content {
        color: #0d47a1;
        font-size: 0.95rem;
    }

    /* استایل‌های خاص برای سیستم‌های امنیتی پزشکی */
    .hipaa-warning {
        background: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: 4px;
        padding: 15px;
        margin: 20px 0;
        border-left: 4px solid #007bff;
    }

    .hipaa-title {
        font-weight: bold;
        color: #007bff;
        margin-bottom: 8px;
    }

    .hipaa-content {
        color: #495057;
        font-size: 0.95rem;
    }

    /* استایل‌های خاص برای سیستم‌های پزشکی */
    .medical-system-note {
        background: #e8f5e9;
        border: 1px solid #c8e6c9;
        border-radius: 4px;
        padding: 15px;
        margin: 20px 0;
    }

    .medical-system-title {
        font-weight: bold;
        color: #1b5e20;
        margin-bottom: 8px;
    }

    .medical-system-content {
        color: #1b5e20;
        font-size: 0.95rem;
    }

    /* استایل‌های خاص برای سیستم‌های اضطراری */
    .emergency-system-note {
        background: #fff8e1;
        border: 1px solid #ffecb3;
        border-radius: 4px;
        padding: 15px;
        margin: 20px 0;
    }

    .emergency-system-title {
        font-weight: bold;
        color: #e65100;
        margin-bottom: 8px;
    }

    .emergency-system-content {
        color: #e65100;
        font-size: 0.95rem;
    }
</style>

<div class="delete-container print-section">
    <div class="page-header no-print">
        <h1 class="page-title">تأیید حذف دپارتمان</h1>
        <p class="page-description">عملیات حذف دپارتمان در سیستم کلینیک شفا</p>
    </div>

    <!-- هشدار امنیتی پزشکی -->
    <div class="warning-box">
        <div class="text-center">
            <i class="fa fa-exclamation-triangle warning-icon"></i>
            <h3>هشدار امنیتی مهم پزشکی</h3>
            <p>حذف دپارتمان یک عملیات برگشت‌ناپذیر است و می‌تواند بر تمام داده‌های پزشکی تأثیر بگذارد.</p>
            <p>لطفاً قبل از ادامه، مطمئن شوید که این دپارتمان پزشک فعالی ندارد یا از اطلاعات پشتیبان گرفته‌اید.</p>
        </div>
    </div>

    <!-- یادآوری استانداردهای پزشکی -->
    <div class="hipaa-warning">
        <div class="hipaa-title">
            <i class="fa fa-shield-alt"></i> رعایت استانداردهای امنیتی پزشکی
        </div>
        <div class="hipaa-content">
            <p>بر اساس استانداردهای امنیتی پزشکی، حذف دپارتمان‌ها باید با احتیاط کامل انجام شود:</p>
            <ul>
                <li>حذف فیزیکی داده‌های پزشکی مجاز نیست و فقط از سیستم حذف نرم (Soft Delete) استفاده شود</li>
                <li>تمام تغییرات باید در سیستم ردیابی (Audit Trail) ثبت شوند</li>
                <li>داده‌های پزشکی باید برای مدت طولانی (حداقل ۱۰ سال) حفظ شوند</li>
            </ul>
        </div>
    </div>

    <!-- اطلاعات دپارتمان -->
    <div class="department-info">
        <h2 class="mb-4">اطلاعات دپارتمان "@Model.Name"</h2>

        <div class="info-row">
            <div class="info-label">نام دپارتمان:</div>
            <div class="info-value">@Model.Name</div>
        </div>

        <div class="info-row">
            <div class="info-label">کلینیک مربوطه:</div>
            <div class="info-value">@Model.ClinicName</div>
        </div>

        <div class="info-row">
            <div class="info-label">وضعیت:</div>
            <div class="info-value">
                <span class="badge @(Model.IsActive ? "badge-success" : "badge-danger")">
                    @(Model.IsActive ? "فعال" : "غیرفعال")
                </span>
            </div>
        </div>

        <div class="info-row">
            <div class="info-label">تاریخ ایجاد:</div>
            <div class="info-value">
                <i class="fa fa-calendar-alt calendar-icon"></i>
                @Model.CreatedAt.ToString("yyyy/MM/dd HH:mm") توسط <strong>@Model.CreatedBy</strong>
            </div>
        </div>

        @if (Model.UpdatedAt.HasValue)
        {
            <div class="info-row">
                <div class="info-label">آخرین به‌روزرسانی:</div>
                <div class="info-value">
                    <i class="fa fa-sync-alt calendar-icon"></i>
                    @Model.UpdatedAt.Value.ToString("yyyy/MM/dd HH:mm") توسط <strong>@Model.UpdatedBy</strong>
                </div>
            </div>
        }

        @if (Model.DeletedAt.HasValue)
        {
            <div class="info-row">
                <div class="info-label">تاریخ حذف:</div>
                <div class="info-value">
                    <i class="fa fa-trash calendar-icon"></i>
                    @Model.DeletedAt.Value.ToString("yyyy/MM/dd HH:mm") توسط <strong>@Model.DeletedBy</strong>
                </div>
            </div>
        }
    </div>

    <!-- آمار دپارتمان -->
    <div class="stats-section">
        <div class="stats-item">
            <div class="stats-value">@Model.DoctorCount</div>
            <div class="stats-label">پزشک فعال</div>
        </div>
        <div class="stats-item">
            <div class="stats-value">@Model.ServiceCount</div>
            <div class="stats-label">خدمات فعال</div>
        </div>
        <div class="stats-item">
            <div class="stats-value">@(Model.DoctorCount * 10)</div>
            <div class="stats-label">نوبت‌ها</div>
        </div>
    </div>

    <!-- سیستم اضطراری پزشکی -->
    <div class="emergency-system-note">
        <div class="emergency-system-title">
            <i class="fa fa-ambulance"></i> سیستم اضطراری پزشکی
        </div>
        <div class="emergency-system-content">
            <p>در شرایط اورژانس، لطفاً از این مراحل استفاده کنید:</p>
            <ol>
                <li>اگر دپارتمان در حال استفاده است، ابتدا تمام پزشکان را به دپارتمان دیگری منتقل کنید</li>
                <li>در صورت نیاز فوری به حذف، ابتدا یک نسخه پشتیبان کامل از داده‌ها تهیه کنید</li>
                <li>عملیات حذف را فقط پس از تأیید توسط مدیر سیستم انجام دهید</li>
            </ol>
        </div>
    </div>

    <!-- لیست پزشکان فعال -->
    @if (Model.DoctorCount > 0)
    {
        <div class="alert alert-warning">
            <i class="fa fa-info-circle"></i>
            این دپارتمان @Model.DoctorCount پزشک فعال دارد که پس از حذف دپارتمان، به حالت غیرفعال درخواهند آمد.
            لطفاً مطمئن شوید که این عملیات مورد تأیید است.
        </div>

        <div class="active-doctors-list">
            @foreach (var doctor in (IEnumerable<DoctorIndexViewModel>)ViewBag.ActiveDoctors)
            {
                <div class="doctor-item">
                    <i class="fa fa-user-md"></i> @doctor.FullName - @doctor.Specialization
                </div>
            }
        </div>
    }

    <!-- بررسی امکان حذف -->
    @if (Model.DoctorCount > 0)
    {
        <div class="alert alert-danger">
            <i class="fa fa-warning"></i>
            امکان حذف این دپارتمان وجود ندارد چون @Model.DoctorCount پزشک فعال دارد.
            لطفاً ابتدا تمام پزشکان را حذف یا منتقل کنید.
        </div>
    }
    else
    {
        <div class="alert alert-warning">
            <i class="fa fa-info-circle"></i>
            این دپارتمان هیچ پزشک فعالی ندارد و می‌تواند حذف شود.
            لطفاً نام دپارتمان را برای تأیید نهایی وارد کنید.
        </div>
    }

    <!-- بخش تأیید حذف -->
    @if (Model.DoctorCount == 0)
    {
        <div class="confirmation-section">
            <h3 class="mb-4">تأیید نهایی حذف دپارتمان</h3>

            <p>برای تأیید حذف دپارتمان "@Model.Name"، لطفاً نام دپارتمان را دقیقاً همان‌طور که در زیر آمده است وارد کنید:</p>

            <div class="alert alert-light">
                <strong>@Model.Name</strong>
            </div>

            <div class="confirmation-input">
                <input type="text" id="confirmationInput" class="form-control"
                       placeholder="نام دپارتمان را اینجا وارد کنید"
                       autocomplete="off">
                <div id="confirmationError" class="text-danger" style="display: none; margin-top: 5px;">
                    نام دپارتمان وارد شده با نام دپارتمان مورد نظر مطابقت ندارد
                </div>
            </div>

            <!-- سیستم تأیید دوم برای داده‌های پزشکی -->
            <div class="confirmation-input">
                <label for="securityCode">کد امنیتی پزشکی (از مدیر سیستم دریافت کنید):</label>
                <input type="password" id="securityCode" class="form-control"
                       placeholder="کد امنیتی پزشکی"
                       autocomplete="off">
                <div id="securityCodeError" class="text-danger" style="display: none; margin-top: 5px;">
                    کد امنیتی نامعتبر است
                </div>
            </div>

            <div class="text-center">
                <a href="@Url.RouteUrl("Admin_default", new { controller = "Department", action = "Index" })"
                   class="btn btn-secondary mr-2">
                    <i class="fa fa-arrow-left"></i> انصراف
                </a>
                <button type="button" id="deleteButton" class="btn btn-delete" disabled>
                    <i class="fa fa-trash"></i> تأیید و حذف دپارتمان
                </button>
            </div>
        </div>
    }
    else
    {
        <div class="text-center mt-4">
            <a href="@Url.RouteUrl("Admin_default", new { controller = "Department", action = "Index" })"
               class="btn btn-secondary">
                <i class="fa fa-arrow-left"></i> بازگشت به لیست دپارتمان‌ها
            </a>
            <a href="@Url.RouteUrl("Admin_default", new { controller = "Doctors", action = "Index", departmentId = Model.DepartmentId })"
               class="btn btn-primary ml-2">
                <i class="fa fa-user-md"></i> مدیریت پزشکان
            </a>
        </div>
    }

    <!-- اطلاعات ردیابی پزشکی -->
    <div class="audit-trail">
        <h3 style="margin: 0 0 10px 0; color: #007bff;">تاریخچه عملیات پزشکی</h3>
        <div class="audit-item">
            <span class="audit-user">@Model.CreatedBy</span>
            <span class="audit-time">(@Model.CreatedAt.ToString("yyyy/MM/dd HH:mm"))</span>
            <span class="audit-action">ایجاد دپارتمان</span>
        </div>

        @if (Model.UpdatedAt.HasValue)
        {
            <div class="audit-item">
                <span class="audit-user">@Model.UpdatedBy</span>
                <span class="audit-time">(@Model.UpdatedAt.Value.ToString("yyyy/MM/dd HH:mm"))</span>
                <span class="audit-action">به‌روزرسانی اطلاعات</span>
            </div>
        }

        @if (Model.DeletedAt.HasValue)
        {
            <div class="audit-item">
                <span class="audit-user">@Model.DeletedBy</span>
                <span class="audit-time">(@Model.DeletedAt.Value.ToString("yyyy/MM/dd HH:mm"))</span>
                <span class="audit-action">حذف دپارتمان</span>
            </div>
        }
    </div>

    <!-- سیستم امنیتی پزشکی -->
    <div class="security-note">
        <div class="security-note-title">
            <i class="fa fa-lock"></i> یادآوری سیستم امنیتی پزشکی
        </div>
        <div class="security-note-content">
            <p>بر اساس استانداردهای امنیتی پزشکی:</p>
            <ul>
                <li>تمام تغییرات در سیستم پزشکی باید ثبت و ردیابی شوند</li>
                <li>حذف داده‌های پزشکی باید با رعایت کامل استانداردهای قانونی انجام شود</li>
                <li>فقط کاربران مجاز با نقش‌های "مدیر" یا "پذیرش" می‌توانند دپارتمان‌ها را حذف کنند</li>
                <li>تمام عملیات‌های حذف در سیستم اطلاع‌رسانی ثبت می‌شوند</li>
            </ul>
        </div>
    </div>
</div>

<!-- لایه لودینگ -->
<div class="loading-overlay" id="loadingOverlay">
    <div class="loading-spinner"></div>
    <p style="margin-top: 15px;">در حال پردازش درخواست حذف دپارتمان...</p>
    <p style="margin-top: 10px; font-size: 0.9rem; color: #6c757d;">لطفاً صبور باشید - سیستم در حال ثبت اطلاعات برای اهداف امنیتی پزشکی است</p>
</div>

<!-- اسکریپت‌های حیاتی برای عملکرد بالا -->
<script type="text/javascript">
    // این اسکریپت‌ها به صورت inline برای کاهش تعداد درخواست‌ها اضافه شده‌اند
    (function() {
        'use strict';

        document.addEventListener('DOMContentLoaded', function() {
            const confirmationInput = document.getElementById('confirmationInput');
            const securityCodeInput = document.getElementById('securityCode');
            const deleteButton = document.getElementById('deleteButton');
            const confirmationError = document.getElementById('confirmationError');
            const securityCodeError = document.getElementById('securityCodeError');
            const loadingOverlay = document.getElementById('loadingOverlay');

            // بررسی مطابقت نام دپارتمان
            function validateConfirmation() {
                const expectedName = '@Html.Raw(Model.Name)';
                const enteredName = confirmationInput ? confirmationInput.value.trim() : '';
                const securityCode = securityCodeInput ? securityCodeInput.value.trim() : '';

                if (confirmationError) confirmationError.style.display = 'none';
                if (securityCodeError) securityCodeError.style.display = 'none';

                let isValid = true;

                if (confirmationInput && enteredName !== expectedName) {
                    if (confirmationError) {
                        confirmationError.style.display = 'block';
                        confirmationError.textContent = 'نام دپارتمان وارد شده با نام دپارتمان مورد نظر مطابقت ندارد';
                    }
                    isValid = false;
                }

                if (securityCodeInput && securityCode.length < 6) {
                    if (securityCodeError) {
                        securityCodeError.style.display = 'block';
                        securityCodeError.textContent = 'کد امنیتی باید حداقل 6 کاراکتر باشد';
                    }
                    isValid = false;
                }

                if (deleteButton) {
                    deleteButton.disabled = !isValid;
                }

                return isValid;
            }

            // تنظیم رویداد تغییر متن
            if (confirmationInput) {
                confirmationInput.addEventListener('input', validateConfirmation);
            }

            if (securityCodeInput) {
                securityCodeInput.addEventListener('input', validateConfirmation);
            }

            // تنظیم کلیدهای میانبر پزشکی
            document.addEventListener('keydown', function(e) {
                // Alt + D برای فوکوس روی فیلد تأیید
                if (e.altKey && e.key === 'd' && confirmationInput) {
                    e.preventDefault();
                    confirmationInput.focus();
                }

                // Alt + C برای انصراف
                if (e.altKey && e.key === 'c') {
                    e.preventDefault();
                    window.location.href = '@Url.RouteUrl("Admin_default", new { controller = "Department", action = "Index" })';
                }

                // Alt + S برای فوکوس روی فیلد کد امنیتی
                if (e.altKey && e.key === 's' && securityCodeInput) {
                    e.preventDefault();
                    securityCodeInput.focus();
                }

                // Alt + D دوباره برای حذف (پس از تأیید)
                if (e.altKey && e.key === 'd' && deleteButton && !deleteButton.disabled) {
                    e.preventDefault();
                    deleteButton.click();
                }
            });

            // تنظیم دکمه حذف
            if (deleteButton) {
                deleteButton.addEventListener('click', function() {
                    if (!validateConfirmation()) {
                        return;
                    }

                    // نمایش لودر
                    if (loadingOverlay) {
                        loadingOverlay.style.display = 'flex';
                    }

                    // ایجاد فرم دیتا
                    const formData = new FormData();
                    formData.append('id', '@Model.DepartmentId');
                    formData.append('__RequestVerificationToken', document.querySelector('input[name="__RequestVerificationToken"]').value);

                    // افزودن کد امنیتی
                    if (securityCodeInput) {
                        formData.append('securityCode', securityCodeInput.value);
                    }

                    // ارسال درخواست
                    fetch('@Url.RouteUrl("Admin_default", new { controller = "Department", action = "DeleteConfirmed", id = Model.DepartmentId })', {
                        method: 'POST',
                        body: formData
                    })
                    .then(response => {
                        if (response.ok) {
                            return response.text();
                        }
                        throw new Error('خطا در ارتباط با سرور');
                    })
                    .then(html => {
                        try {
                            const parser = new DOMParser();
                            const doc = parser.parseFromString(html, 'text/html');
                            const successMessage = doc.querySelector('.alert-success') ||
                                                 doc.querySelector('[data-success="true"]');

                            if (successMessage) {
                                // موفقیت‌آمیز بوده - هدایت به لیست
                                window.location.href = '@Url.RouteUrl("Admin_default", new { controller = "Department", action = "Index" })';
                            } else {
                                // خطا در حذف
                                const errorMessage = doc.querySelector('.alert-danger') ||
                                                  doc.querySelector('[data-error="true"]');
                                if (errorMessage) {
                                    alert('خطا در حذف دپارتمان: ' + errorMessage.textContent.trim());
                                } else {
                                    alert('خطای ناشناخته رخ داده است. لطفاً مجدداً تلاش کنید.');
                                }

                                // پنهان کردن لودر
                                if (loadingOverlay) {
                                    loadingOverlay.style.display = 'none';
                                }
                            }
                        } catch (e) {
                            console.error('Error parsing response:', e);
                            alert('خطای سیستم رخ داده است. لطفاً مجدداً تلاش کنید.');
                            if (loadingOverlay) {
                                loadingOverlay.style.display = 'none';
                            }
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('خطا در ارتباط با سرور. لطفاً اتصال اینترنت خود را بررسی کنید.');
                        if (loadingOverlay) {
                            loadingOverlay.style.display = 'none';
                        }
                    });
                });
            }

            // بهینه‌سازی برای دستگاه‌های پزشکی
            if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.body.style.transition = 'none';
            }

            // راهنمای سریع برای کاربران جدید
            if (!sessionStorage.getItem('deleteDepartmentHelpShown')) {
                setTimeout(() => {
                    alert('راهنمای حذف دپارتمان در سیستم پزشکی:\n' +
                          '- برای تأیید حذف، نام دپارتمان را دقیقاً وارد کنید\n' +
                          '- کد امنیتی پزشکی را وارد کنید (دریافت از مدیر سیستم)\n' +
                          '- Alt+D: فوکوس روی فیلد تأیید یا حذف (در صورت تأیید)\n' +
                          '- Alt+S: فوکوس روی فیلد کد امنیتی\n' +
                          '- Alt+C: انصراف از حذف');
                    sessionStorage.setItem('deleteDepartmentHelpShown', 'true');
                }, 2000);
            }
        });
    })();
</script>