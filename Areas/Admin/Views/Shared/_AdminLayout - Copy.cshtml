@using System
@{
    var appName = "سامانه مدیریت کلینیک";
    var title = (ViewBag.Title as string) ?? "داشبورد";
    var metaDescription = (ViewBag.MetaDescription as string) ?? "سامانه مدیریت کلینیک: مدیریت بیماران، نوبت‌ها، پزشکان، پرداخت‌ها و گزارش‌ها با رابط کاربری مدرن و حرفه‌ای";
    var metaKeywords = (ViewBag.MetaKeywords as string) ?? "کلینیک, پزشکی, درمان, نوبت, بیمار, پزشک, پرداخت, گزارش, مدیریت کلینیک";
    var baseUrl = Request?.Url?.GetLeftPart(UriPartial.Authority) ?? "https://example.com";
    var canonicalUrl = (ViewBag.CanonicalUrl as string) ?? (Request != null ? (Request.Url?.GetLeftPart(UriPartial.Authority) + Request.RawUrl) : baseUrl);
    var logoPath = Url.Content("~/Content/Images/clinic-logo.png"); // قرار دهید
    var hasBreadcrumb = IsSectionDefined("Breadcrumb");
}

<!DOCTYPE html>
<html lang="fa" dir="rtl" data-bs-theme="light" class="h-100">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>@title - @appName</title>

    <!-- SEO Essentials -->
    <meta name="description" content="@metaDescription" />
    <meta name="keywords" content="@metaKeywords" />
    <link rel="canonical" href="@canonicalUrl" />

    <!-- Open Graph / Twitter Card -->
    <meta property="og:type" content="website" />
    <meta property="og:locale" content="fa_IR" />
    <meta property="og:title" content="@title - @appName" />
    <meta property="og:description" content="@metaDescription" />
    <meta property="og:url" content="@baseUrl" />
    <meta property="og:site_name" content="@appName" />
    <meta property="og:image" content="@logoPath" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="@title - @appName" />
    <meta name="twitter:description" content="@metaDescription" />
    <meta name="twitter:image" content="@logoPath" />

    <!-- Fonts: Vazirmatn (Google Fonts) -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;700;900&display=swap" rel="stylesheet" />

    <!-- Bootstrap 5 RTL & Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" />

    <!-- Toastr (اگر باندل دارید، می‌توانید از باندل خود استفاده کنید) -->
    @Styles.Render("~/Content/toastr")

    <!-- App Styles (می‌توانید به باندل خود منتقل کنید) -->
    <style>
        :root {
            --brand: #0ea5e9; /* آبی ملایم */
            --brand-2: #22c55e; /* سبز پزشکی */
            --bg-soft: #f6fafc;
        }

        html, body {
            height: 100%;
        }

        body {
            font-family: "Vazirmatn", system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
            background: var(--bg-soft);
            overflow-y: scroll;
        }
        /* Header */
        .app-header {
            backdrop-filter: saturate(180%) blur(6px);
        }

        .navbar-brand img {
            height: 32px;
            width: auto;
        }

        .navbar .nav-link {
            font-weight: 500;
        }

        .mega-menu {
            min-width: 720px;
        }

            .mega-menu .col > h6 {
                font-weight: 700;
                font-size: .95rem;
            }
        /* Sidebar */
        .app-shell {
            display: grid;
            grid-template-columns: 260px 1fr;
            gap: 1rem;
        }

        .sidebar {
            position: sticky;
            top: 72px;
            height: calc(100dvh - 88px);
            overflow-y: auto;
            padding-bottom: 1rem;
        }

            .sidebar .nav-link {
                border-radius: .75rem;
                padding: .6rem .75rem;
            }

                .sidebar .nav-link.active, .sidebar .nav-link:hover {
                    background-color: rgba(14,165,233,.1);
                    color: #0ea5e9;
                }

        body.sidebar-collapsed .sidebar {
            width: 84px;
        }

            body.sidebar-collapsed .sidebar .link-text {
                display: none;
            }

            body.sidebar-collapsed .sidebar .nav-link {
                justify-content: center;
            }
        /* Cards & Hover */
        .card {
            border: 0;
            border-radius: 1rem;
            box-shadow: 0 4px 20px rgba(0,0,0,.04);
        }

            .card:hover {
                transform: translateY(-2px);
                transition: .2s ease;
                box-shadow: 0 6px 26px rgba(0,0,0,.06);
            }
        /* Footer */
        footer a {
            text-decoration: none;
        }
        /* Breadcrumb */
        .breadcrumb {
            --bs-breadcrumb-divider: ">";
        }
        /* Utilities */
        .rounded-2xl {
            border-radius: 1rem !important;
        }

        .text-brand {
            color: var(--brand) !important;
        }

        .bg-brand {
            background-color: var(--brand) !important;
        }

        .bg-brand-2 {
            background-color: var(--brand-2) !important;
        }
        /* Dark tweaks when data-bs-theme="dark" */
        [data-bs-theme="dark"] body {
            background: #0b1320;
        }

        [data-bs-theme="dark"] .card {
            box-shadow: none;
            border: 1px solid rgba(255,255,255,.08);
        }
    </style>

    <!-- JSON-LD Schema: MedicalClinic -->
    <script type="application/ld+json">
    {
      "@@context": "https://schema.org",
      "@@type": "MedicalClinic",
      "name": "@appName",
      "url": "@baseUrl",
      "logo": "@logoPath",
      "image": "@logoPath",
      "telephone": "+98-34-000000",
      "address": {
        "@@type": "PostalAddress",
        "streetAddress": "خیابان نمونه ۱۲۳",
        "addressLocality": "جیرفت",
        "addressCountry": "IR"
      },
      "openingHours": ["Sa-Thu 08:00-20:00"],
      "sameAs": [
        "https://www.instagram.com/clinic",
        "https://t.me/clinic"
      ]
    }
    </script>

    @Scripts.Render("~/bundles/modernizr")
</head>
<body class="d-flex flex-column min-vh-100">
    <!-- Header / Top Nav -->
    <header class="app-header sticky-top border-bottom bg-white py-2">
        <nav class="navbar navbar-expand-lg container-lg" aria-label="ناوبری اصلی">
            <div class="d-flex align-items-center gap-2">
                <button id="btnSidebar" class="btn btn-outline-secondary d-none d-lg-inline-flex rounded-2xl" type="button" title="باز و بسته کردن سایدبار" aria-label="Toggle sidebar">
                    <i class="bi bi-layout-sidebar-inset"></i>
                </button>
                <a class="navbar-brand d-flex align-items-center gap-2" href="@Url.Action("Index","Home")" title="@appName">
                    <img src="@logoPath" alt="لوگوی کلینیک" loading="lazy" />
                    <span class="fw-bold">@appName</span>
                </a>
            </div>

            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#topNav" aria-controls="topNav" aria-expanded="false" aria-label="باز/بستن منو">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="topNav">
                <!-- Mega Menu Root -->
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item dropdown position-static">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            منو
                        </a>
                        <div class="dropdown-menu w-100 shadow mega-menu p-4 border-0 rounded-4">
                            <div class="container">
                                <div class="row g-4">
                                    <div class="col-12 col-md-4">
                                        <h6 class="mb-2">مدیریت اصلی</h6>
                                        <ul class="list-unstyled small m-0">
                                            <li><a class="dropdown-item py-2" href="@Url.Action("Index","Dashboard")"><i class="bi bi-speedometer2 me-2"></i> داشبورد</a></li>
                                            <li><a class="dropdown-item py-2" href="@Url.Action("Index","Patients")"><i class="bi bi-people me-2"></i> بیماران</a></li>
                                            <li><a class="dropdown-item py-2" href="@Url.Action("Index","Appointments")"><i class="bi bi-calendar2-week me-2"></i> نوبت‌ها</a></li>
                                        </ul>
                                    </div>
                                    <div class="col-12 col-md-4">
                                        <h6 class="mb-2">منابع درمان</h6>
                                        <ul class="list-unstyled small m-0">
                                            <li><a class="dropdown-item py-2" href="@Url.Action("Index","Doctors")"><i class="bi bi-person-badge me-2"></i> پزشکان <span class="badge text-bg-success rounded-pill">جدید</span></a></li>
                                            <li><a class="dropdown-item py-2" href="@Url.Action("Index","Payments")"><i class="bi bi-credit-card me-2"></i> پرداخت‌ها</a></li>
                                            <li><a class="dropdown-item py-2" href="@Url.Action("Index","Reports")"><i class="bi bi-graph-up-arrow me-2"></i> گزارشات</a></li>
                                        </ul>
                                    </div>
                                    <div class="col-12 col-md-4">
                                        <h6 class="mb-2">پیکربندی</h6>
                                        <ul class="list-unstyled small m-0">
                                            <li><a class="dropdown-item py-2" href="@Url.Action("Index","Settings")"><i class="bi bi-sliders me-2"></i> تنظیمات</a></li>
                                            <li><a class="dropdown-item py-2" href="@Url.Action("Index","Notifications")"><i class="bi bi-bell me-2"></i> اعلان‌ها</a></li>
                                            <li><a class="dropdown-item py-2" href="@Url.Action("Help","Home")"><i class="bi bi-life-preserver me-2"></i> راهنمای سامانه</a></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </li>
                </ul>

                <!-- Search -->
                <form class="d-none d-md-flex me-3" role="search" action="@Url.Action("Search","Common")" method="get">
                    <div class="input-group rounded-2xl">
                        <input name="q" class="form-control" type="search" placeholder="جستجو در کلینیک..." aria-label="Search" />
                        <button class="btn btn-outline-secondary" type="submit" title="جستجو"><i class="bi bi-search"></i></button>
                    </div>
                </form>

                <!-- Right tools -->
                <ul class="navbar-nav mb-2 mb-lg-0 align-items-center gap-lg-1">
                    <li class="nav-item me-2">
                        <button id="btnTheme" class="btn btn-outline-secondary rounded-2xl" type="button" aria-label="تغییر تم" title="حالت روشن/تاریک">
                            <i class="bi bi-moon-stars"></i>
                        </button>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link" href="#" id="notifDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="اعلان‌ها">
                            <i class="bi bi-bell"></i>
                            <span class="position-absolute top-25 start-0 translate-middle badge rounded-pill text-bg-danger">3</span>
                        </a>
                        <div class="dropdown-menu dropdown-menu-end shadow border-0 rounded-4 p-0" aria-labelledby="notifDropdown" style="min-width: 320px">
                            <div class="p-3 border-bottom fw-bold">اعلان‌ها</div>
                            <div class="list-group list-group-flush small">
                                <a class="list-group-item list-group-item-action" href="#"><i class="bi bi-calendar-event me-2"></i> نوبت فردا برای «سارا احمدی» تایید شد.</a>
                                <a class="list-group-item list-group-item-action" href="#"><i class="bi bi-credit-card me-2"></i> پرداخت صورتحساب #584 موفق بود.</a>
                                <a class="list-group-item list-group-item-action" href="#"><i class="bi bi-exclamation-circle me-2"></i> موجودی داروخانه رو به کاهش است.</a>
                            </div>
                            <div class="p-2 text-center"><a href="@Url.Action("Index","Notifications")" class="btn btn-link">مشاهده همه</a></div>
                        </div>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle d-flex align-items-center gap-2" href="#" data-bs-toggle="dropdown" aria-expanded="false">
                            <img src="@Url.Content("~/Content/Images/avatar.png")" alt="آواتار کاربر" class="rounded-circle" width="32" height="32" loading="lazy" />
                            <span class="d-none d-lg-inline">@User.Identity.Name</span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end shadow border-0 rounded-4">
                            <li><h6 class="dropdown-header">حساب کاربری</h6></li>
                            <li><a class="dropdown-item" href="@Url.Action("Profile","Account")"><i class="bi bi-person me-2"></i> پروفایل</a></li>
                            <li><a class="dropdown-item" href="@Url.Action("Preferences","Account")"><i class="bi bi-gear me-2"></i> تنظیمات من</a></li>
                            <li><hr class="dropdown-divider" /></li>
                            <li>@Html.ActionLink("خروج", "LogOff", "Account", null, new { @class = "dropdown-item text-danger" })</li>
                        </ul>
                    </li>
                </ul>
            </div>
        </nav>
    </header>

    <!-- App Shell -->
    <div class="container-lg flex-grow-1 my-3 app-shell">
        <!-- Sidebar -->
        <aside class="sidebar">
            <nav class="nav flex-column gap-1" aria-label="سایدبار">
                <a class="nav-link d-flex align-items-center gap-2 active" href="@Url.Action("Index","Dashboard")"><i class="bi bi-speedometer2 fs-5"></i><span class="link-text">داشبورد</span></a>
                <a class="nav-link d-flex align-items-center gap-2" href="@Url.Action("Index","Patients")"><i class="bi bi-people fs-5"></i><span class="link-text">بیماران</span></a>
                <a class="nav-link d-flex align-items-center gap-2" href="@Url.Action("Index","Appointments")"><i class="bi bi-calendar2-week fs-5"></i><span class="link-text">نوبت‌ها</span></a>
                <a class="nav-link d-flex align-items-center gap-2" href="@Url.Action("Index","Doctors")"><i class="bi bi-person-badge fs-5"></i><span class="link-text">پزشکان</span></a>
                <a class="nav-link d-flex align-items-center gap-2" href="@Url.Action("Index","Payments")"><i class="bi bi-credit-card fs-5"></i><span class="link-text">پرداخت‌ها</span></a>
                <a class="nav-link d-flex align-items-center gap-2" href="@Url.Action("Index","Reports")"><i class="bi bi-graph-up-arrow fs-5"></i><span class="link-text">گزارشات</span></a>
                <a class="nav-link d-flex align-items-center gap-2" href="@Url.Action("Index","Settings")"><i class="bi bi-sliders fs-5"></i><span class="link-text">تنظیمات</span></a>
            </nav>
            <hr />
            <div class="p-3 small text-muted">
                <div class="fw-bold mb-2">میانبرها</div>
                <div class="d-grid gap-2">
                    <a class="btn btn-outline-primary rounded-2xl" href="@Url.Action("Create","Appointments")"><i class="bi bi-plus-circle me-1"></i> نوبت جدید</a>
                    <a class="btn btn-outline-success rounded-2xl" href="@Url.Action("Create","Patients")"><i class="bi bi-person-plus me-1"></i> بیمار جدید</a>
                </div>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main id="main" class="pb-4">
            @if (hasBreadcrumb)
            {
                <nav class="mb-3" aria-label="breadcrumb">
                    @RenderSection("Breadcrumb", required: false)
                </nav>
            }

            @RenderBody()

            @* نمونه داشبورد – فقط اگر بخواهید پیش‌نمایش در Layout داشته باشید: *@
            @if (ViewBag.ShowDashboardDemo == true)
            {
                <section class="row g-3 mt-2">
                    <!-- Stat Cards -->
                    <div class="col-12 col-sm-6 col-xl-3">
                        <div class="card">
                            <div class="card-body d-flex align-items-center justify-content-between">
                                <div>
                                    <div class="text-muted small">بیماران امروز</div>
                                    <div class="h4 mb-0">32</div>
                                </div>
                                <i class="bi bi-people fs-1 text-brand"></i>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-sm-6 col-xl-3">
                        <div class="card">
                            <div class="card-body d-flex align-items-center justify-content-between">
                                <div>
                                    <div class="text-muted small">نوبت‌های آتی</div>
                                    <div class="h4 mb-0">76</div>
                                </div>
                                <i class="bi bi-calendar2-week fs-1 text-success"></i>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-sm-6 col-xl-3">
                        <div class="card">
                            <div class="card-body d-flex align-items-center justify-content-between">
                                <div>
                                    <div class="text-muted small">درآمد امروز</div>
                                    <div class="h4 mb-0">18,450,000 تومان</div>
                                </div>
                                <i class="bi bi-cash-coin fs-1 text-brand"></i>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-sm-6 col-xl-3">
                        <div class="card">
                            <div class="card-body d-flex align-items-center justify-content-between">
                                <div>
                                    <div class="text-muted small">پیام‌های جدید</div>
                                    <div class="h4 mb-0">5</div>
                                </div>
                                <i class="bi bi-chat-dots fs-1 text-warning"></i>
                            </div>
                        </div>
                    </div>

                    <!-- Appointments Calendar (placeholder) -->
                    <div class="col-12 col-xxl-8">
                        <div class="card h-100">
                            <div class="card-header bg-transparent d-flex align-items-center justify-content-between">
                                <h5 class="mb-0">تقویم نوبت‌ها</h5>
                                <div class="btn-group">
                                    <button class="btn btn-sm btn-outline-secondary">هفته</button>
                                    <button class="btn btn-sm btn-outline-secondary">ماه</button>
                                    <button class="btn btn-sm btn-outline-primary">امروز</button>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="row row-cols-7 g-2 text-center small">
                                    @for (var i = 1; i <= 28; i++)
                                    {
                                        <div class="col">
                                            <div class="border rounded-2 p-2">@i</div>
                                        </div>
                                    }
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Notifications -->
                    <div class="col-12 col-xxl-4">
                        <div class="card h-100">
                            <div class="card-header bg-transparent"><h5 class="mb-0">اعلان‌های اخیر</h5></div>
                            <div class="list-group list-group-flush">
                                <a class="list-group-item list-group-item-action" href="#"><i class="bi bi-check2-circle me-2"></i> پرونده «رضا مرادی» تکمیل شد.</a>
                                <a class="list-group-item list-group-item-action" href="#"><i class="bi bi-file-earmark-text me-2"></i> گزارش مالی مرداد آماده است.</a>
                                <a class="list-group-item list-group-item-action" href="#"><i class="bi bi-thermometer-half me-2"></i> واکسن آنفلوآنزا موجود شد.</a>
                            </div>
                        </div>
                    </div>

                    <!-- Patients Table (sample) -->
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header bg-transparent d-flex align-items-center justify-content-between">
                                <h5 class="mb-0">جدول بیماران</h5>
                                <a href="@Url.Action("Create","Patients")" class="btn btn-sm btn-primary rounded-2xl"><i class="bi bi-person-plus me-1"></i> افزودن</a>
                            </div>
                            <div class="table-responsive">
                                <table class="table align-middle mb-0">
                                    <thead>
                                        <tr>
                                            <th>نام</th>
                                            <th>کد ملی</th>
                                            <th>سن</th>
                                            <th>آخرین مراجعه</th>
                                            <th>وضعیت</th>
                                            <th class="text-center">عملیات</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>الهام آقایی</td>
                                            <td>1234567890</td>
                                            <td>29</td>
                                            <td>1404/05/20</td>
                                            <td><span class="badge text-bg-success">فعال</span></td>
                                            <td class="text-center">
                                                <a class="btn btn-sm btn-outline-secondary rounded-2xl" href="#">پرونده</a>
                                                <a class="btn btn-sm btn-outline-primary rounded-2xl" href="#">نوبت جدید</a>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>حمید رفیعی</td>
                                            <td>0987654321</td>
                                            <td>41</td>
                                            <td>1404/05/18</td>
                                            <td><span class="badge text-bg-warning">در انتظار</span></td>
                                            <td class="text-center">
                                                <a class="btn btn-sm btn-outline-secondary rounded-2xl" href="#">پرونده</a>
                                                <a class="btn btn-sm btn-outline-primary rounded-2xl" href="#">نوبت جدید</a>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </section>
            }
        </main>
    </div>

    <!-- Footer -->
    <footer class="mt-auto border-top bg-white">
        <div class="container-lg py-4">
            <div class="row g-3 align-items-start">
                <div class="col-12 col-md-4">
                    <div class="d-flex align-items-center gap-2 mb-2">
                        <img src="@logoPath" alt="لوگوی کلینیک" width="36" height="36" loading="lazy" />
                        <strong>@appName</strong>
                    </div>
                    <p class="text-muted small mb-2">ارائه‌دهنده خدمات درمانی با کیفیت، با تمرکز بر تجربه کاربری ساده و سریع.</p>
                    <div class="d-flex gap-3">
                        <a href="#" aria-label="اینستاگرام"><i class="bi bi-instagram fs-5"></i></a>
                        <a href="#" aria-label="تلگرام"><i class="bi bi-telegram fs-5"></i></a>
                        <a href="#" aria-label="واتساپ"><i class="bi bi-whatsapp fs-5"></i></a>
                    </div>
                </div>
                <div class="col-6 col-md-2">
                    <h6>لینک‌های سریع</h6>
                    <ul class="list-unstyled small">
                        <li><a href="@Url.Action("Index","Dashboard")">داشبورد</a></li>
                        <li><a href="@Url.Action("Index","Patients")">بیماران</a></li>
                        <li><a href="@Url.Action("Index","Appointments")">نوبت‌ها</a></li>
                        <li><a href="@Url.Action("Index","Reports")">گزارشات</a></li>
                    </ul>
                </div>
                <div class="col-6 col-md-3">
                    <h6>اطلاعات تماس</h6>
                    <ul class="list-unstyled small text-muted">
                        <li>تلفن: 034-xxxxxxx</li>
                        <li>ایمیل: info@clinic.example</li>
                        <li>آدرس: جیرفت، خیابان نمونه ۱۲۳</li>
                    </ul>
                </div>
                <div class="col-12 col-md-3">
                    <h6>ساعت کاری</h6>
                    <ul class="list-unstyled small text-muted">
                        <li>شنبه تا پنج‌شنبه: 8 تا 20</li>
                        <li>جمعه و تعطیلات: با هماهنگی</li>
                    </ul>
                </div>
            </div>
            <div class="text-center mt-3 small text-muted">&copy; @DateTime.Now.Year @appName — تمامی حقوق محفوظ است.</div>
        </div>
    </footer>

    <!-- Breadcrumb (SEO-friendly) - استفاده در صفحات با Section -->
    @section Breadcrumb {
        @* نمونه در صفحه‌ها:
            <ol class="breadcrumb m-0" itemscope itemtype="https://schema.org/BreadcrumbList">
                <li class="breadcrumb-item" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
                    <a itemprop="item" href="@Url.Action("Index","Home")"><span itemprop="name">خانه</span></a>
                    <meta itemprop="position" content="1" />
                </li>
                <li class="breadcrumb-item active" aria-current="page" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
                    <span itemprop="name">داشبورد</span>
                    <meta itemprop="position" content="2" />
                </li>
            </ol>
        *@
    }

    <!-- Scripts -->
    @Scripts.Render("~/bundles/jquery")
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" defer></script>
    @Scripts.Render("~/bundles/toastr")

    <!-- Toastr default options -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            if (window.toastr) {
                toastr.options = {
                    closeButton: true,
                    progressBar: true,
                    positionClass: 'toast-top-left',
                    timeOut: 5000
                };
            }
        });
    </script>

    <!-- App JS: theme toggle, sidebar collapse, lazy imgs -->
    <script>
        (function () {
            const html = document.documentElement;
            const themeKey = 'clinic-theme';
            const sidebarKey = 'clinic-sidebar-collapsed';

            function applyTheme(t) { html.setAttribute('data-bs-theme', t); }
            function currentTheme() { return localStorage.getItem(themeKey) || 'light'; }
            function toggleTheme() { const t = currentTheme() === 'light' ? 'dark' : 'light'; localStorage.setItem(themeKey, t); applyTheme(t); }
            function applySidebar(collapsed) { document.body.classList.toggle('sidebar-collapsed', collapsed); }

            // init
            applyTheme(currentTheme());
            applySidebar(localStorage.getItem(sidebarKey) === '1');

            document.getElementById('btnTheme')?.addEventListener('click', toggleTheme);
            document.getElementById('btnSidebar')?.addEventListener('click', function () {
                const now = !document.body.classList.contains('sidebar-collapsed');
                applySidebar(now);
                localStorage.setItem(sidebarKey, now ? '1' : '0');
            });

            // Lazy loading fallback for older browsers
            if ('loading' in HTMLImageElement.prototype === false) {
                document.querySelectorAll('img[loading="lazy"]').forEach(img => {
                    const src = img.getAttribute('src');
                    if (src) { const i = new Image(); i.src = src; }
                });
            }
        })();
    </script>

    @RenderSection("scripts", required: false)
</body>
</html>