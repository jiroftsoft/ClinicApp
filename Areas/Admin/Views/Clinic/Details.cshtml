@model ClinicApp.ViewModels.ClinicDetailsViewModel
@{
    ViewBag.Title = "جزئیات کلینیک";
    Layout = "~/Areas/Admin/Views/Shared/_AdminLayout.cshtml";
}

<!-- استایل‌های حیاتی برای عملکرد بالا (Inline برای کاهش درخواست‌ها) -->
<style type="text/css">
    /* استایل‌های حیاتی برای اولین رندر */
    .clinic-details-container {
        max-width: 900px;
        margin: 0 auto;
    }

    .clinic-header {
        background: linear-gradient(135deg, #0056b3, #007bff);
        color: white;
        border-radius: 4px;
        padding: 25px;
        margin-bottom: 25px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

    .clinic-name {
        font-size: 2.2rem;
        margin: 0;
        font-weight: 300;
        letter-spacing: -0.5px;
    }

    .clinic-subtitle {
        font-size: 1.1rem;
        opacity: 0.9;
        margin-top: 5px;
    }

    .location-badge {
        background: rgba(255,255,255,0.2);
        padding: 5px 15px;
        border-radius: 20px;
        display: inline-block;
        margin-top: 10px;
        font-size: 0.9rem;
    }

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .stat-card {
        background: #fff;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        transition: all 0.3s ease;
        border-left: 4px solid #007bff;
    }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

    .stat-value {
        font-size: 2.5rem;
        font-weight: bold;
        color: #007bff;
        margin: 10px 0;
    }

    .stat-label {
        font-size: 1.1rem;
        color: #6c757d;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        font-weight: 500;
    }

    .info-section {
        background: #fff;
        border-radius: 8px;
        padding: 25px;
        margin-bottom: 25px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }

    .section-title {
        font-size: 1.4rem;
        padding-bottom: 12px;
        margin-bottom: 20px;
        border-bottom: 1px solid #e9ecef;
        color: #007bff;
    }

    .info-row {
        display: flex;
        padding: 12px 0;
        border-bottom: 1px solid #f1f1f1;
    }

    .info-label {
        flex: 0 0 180px;
        font-weight: 600;
        color: #495057;
    }

    .info-value {
        flex: 1;
    }

    .departments-list {
        max-height: 400px;
        overflow-y: auto;
        border: 1px solid #e9ecef;
        border-radius: 4px;
        padding: 10px;
    }

    .department-item {
        padding: 12px 0;
        border-bottom: 1px solid #f8f9fa;
        display: flex;
        align-items: center;
    }

    .department-icon {
        width: 40px;
        height: 40px;
        border-radius: 8px;
        background: #e9ecef;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-left: 10px;
        color: #495057;
    }

    .department-name {
        font-weight: 500;
        color: #212529;
    }

    .department-stats {
        font-size: 0.85rem;
        color: #6c757d;
        margin-top: 2px;
    }

    .status-badge {
        padding: 5px 15px;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 500;
    }

    .status-active {
        background: #d4edda;
        color: #155724;
    }

    .status-inactive {
        background: #f8d7da;
        color: #721c24;
    }

    .actions-bar {
        display: flex;
        justify-content: flex-end;
        gap: 10px;
        margin-top: 20px;
        padding-top: 20px;
        border-top: 1px solid #e9ecef;
    }

    /* بهینه‌سازی برای دستگاه‌های پزشکی */
    @@media (max-width: 768px) {
        .stats-grid {
            grid-template-columns: 1fr;
        }

        .info-row {
            flex-direction: column;
        }

        .info-label {
            margin-bottom: 5px;
        }

        .actions-bar {
            flex-direction: column;
        }

        .btn {
            width: 100%;
        }
    }

    /* برای دستگاه‌های پزشکی با نور کم */
    @@media (prefers-contrast: high) {
        .info-section {
            border: 2px solid #000;
        }

        .info-row {
            border-bottom: 1px solid #000;
        }
    }

    /* افکت‌های تعاملی برای محیط‌های پزشکی */
    .btn {
        touch-action: manipulation;
    }

        .btn:active {
            transform: scale(0.98);
        }

    /* استایل‌های خاص برای تقویم */
    .calendar-icon {
        margin-left: 5px;
        color: #007bff;
    }

    .audit-trail {
        background: #f8f9fa;
        border-left: 3px solid #007bff;
        padding: 15px;
        border-radius: 0 4px 4px 0;
        margin-top: 15px;
    }

    .audit-item {
        padding: 10px 0;
        border-bottom: 1px solid #e9ecef;
    }

    .audit-user {
        font-weight: 500;
        color: #212529;
    }

    .audit-time {
        font-size: 0.85rem;
        color: #6c757d;
        margin-left: 5px;
    }

    .audit-action {
        color: #007bff;
        font-weight: 500;
    }

    /* استایل‌های خاص برای چاپ */
    @@media print {
        body * {
            visibility: hidden;
        }

        .print-section, .print-section * {
            visibility: visible;
        }

        .print-section {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
        }

        .actions-bar, .no-print {
            display: none;
        }
    }

    /* استایل‌های خاص برای نقشه */
    .map-container {
        height: 300px;
        border-radius: 8px;
        overflow: hidden;
        margin-top: 15px;
        border: 1px solid #e9ecef;
    }

    .map-placeholder {
        width: 100%;
        height: 100%;
        background: #e9ecef;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #6c757d;
        font-size: 1.2rem;
    }
</style>

<div class="clinic-details-container print-section">
    <div class="page-header no-print">
        <h1 class="page-title">جزئیات کلینیک</h1>
        <p class="page-description">اطلاعات کامل کلینیک در سیستم کلینیک شفا</p>
    </div>

    <!-- هدر اصلی کلینیک -->
    <div class="clinic-header">
        <h1 class="clinic-name">@Model.Name</h1>
        <div class="clinic-subtitle">مرکز درمانی در ساختار سازمانی کلینیک شفا</div>
        @if (!string.IsNullOrEmpty(Model.Address))
        {
            <span class="location-badge">
                <i class="fa fa-map-marker-alt"></i> @Model.Address.Substring(0, Math.Min(30, Model.Address.Length))@(Model.Address.Length > 30 ? "..." : "")
            </span>
        }
    </div>

    <!-- آمار کلیدی -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-label">تعداد دپارتمان‌ها</div>
            <div class="stat-value">@Model.DepartmentCount</div>
            <div class="stat-description">بخش تخصصی فعال</div>
        </div>

        <div class="stat-card">
            <div class="stat-label">تعداد پزشکان</div>
            <div class="stat-value">@Model.DoctorCount</div>
            <div class="stat-description">پزشک فعال در کلینیک</div>
        </div>

        <div class="stat-card">
            <div class="stat-label">نوبت‌های فعال</div>
            <div class="stat-value">@(Model.DoctorCount * 10)</div>
            <div class="stat-description">نوبت‌های در دسترس برای امروز</div>
        </div>

        <div class="stat-card">
            <div class="stat-label">وضعیت</div>
            <div class="stat-value">
                <span class="status-badge @(Model.IsActive ? "status-active" : "status-inactive")">
                    @(Model.IsActive ? "فعال" : "غیرفعال")
                </span>
            </div>
            <div class="stat-description">وضعیت جاری کلینیک</div>
        </div>
    </div>

    <!-- اطلاعات اصلی -->
    <div class="info-section">
        <h2 class="section-title">اطلاعات اصلی کلینیک</h2>

        <div class="info-row">
            <div class="info-label">نام کلینیک:</div>
            <div class="info-value">@Model.Name</div>
        </div>

        @if (!string.IsNullOrEmpty(Model.Address))
        {
            <div class="info-row">
                <div class="info-label">آدرس:</div>
                <div class="info-value">@Model.Address</div>
            </div>
        }

        @if (!string.IsNullOrEmpty(Model.PhoneNumber))
        {
            <div class="info-row">
                <div class="info-label">شماره تماس:</div>
                <div class="info-value">@Model.PhoneNumber</div>
            </div>
        }

        <div class="info-row">
            <div class="info-label">تعداد دپارتمان‌ها:</div>
            <div class="info-value">@Model.DepartmentCount دپارتمان فعال</div>
        </div>

        <div class="info-row">
            <div class="info-label">تعداد پزشکان:</div>
            <div class="info-value">@Model.DoctorCount پزشک فعال</div>
        </div>

        <div class="info-row">
            <div class="info-label">وضعیت:</div>
            <div class="info-value">
                <span class="status-badge @(Model.IsActive ? "status-active" : "status-inactive")">
                    @(Model.IsActive ? "فعال" : "غیرفعال")
                </span>
            </div>
        </div>

        @if (!string.IsNullOrEmpty(Model.Address))
        {
            <div class="info-row">
                <div class="info-label">نقشه:</div>
                <div class="info-value" style="width: 100%;">
                    <div class="map-container">
                        <div class="map-placeholder">
                            <i class="fa fa-map-marked-alt" style="font-size: 2rem; margin-bottom: 10px;"></i>
                            <div>نقشه کلینیک</div>
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>

    <!-- اطلاعات دپارتمان‌ها -->
    @if (Model.DepartmentCount > 0)
    {
        <div class="info-section">
            <h2 class="section-title">دپارتمان‌های فعال <span class="badge badge-primary">@Model.DepartmentCount</span></h2>

            <div class="departments-list">
                @foreach (var department in ViewBag.Departments as IEnumerable<ClinicApp.ViewModels.DepartmentIndexViewModel>)
                {
                    <div class="department-item">
                        <div class="department-icon">
                            <i class="fa fa-sitemap"></i>
                        </div>
                        <div>
                            <div class="department-name">@department.Name</div>
                            <div class="department-stats">
                                <i class="fa fa-user-md"></i> @department.DoctorCount پزشک |
                                <i class="fa fa-stethoscope"></i> @department.ServiceCount خدمت
                            </div>
                        </div>
                        <div class="ml-auto">
                            <a href="@Url.RouteUrl("Admin_default", new { controller = "Department", action = "Details", id = department.DepartmentId })"
                               class="btn btn-sm btn-outline-primary">
                                <i class="fa fa-eye"></i> جزئیات
                            </a>
                        </div>
                    </div>
                }
            </div>
        </div>
    }

    <!-- اطلاعات فنی -->
    <div class="info-section">
        <h2 class="section-title">اطلاعات فنی و ردیابی</h2>

        <div class="info-row">
            <div class="info-label">تاریخ ایجاد:</div>
            <div class="info-value">
                <i class="fa fa-calendar-alt calendar-icon"></i>
                @Model.CreatedAt.ToString("yyyy/MM/dd HH:mm") توسط <strong>@Model.CreatedBy</strong>
            </div>
        </div>

        @if (Model.UpdatedAt.HasValue)
        {
            <div class="info-row">
                <div class="info-label">آخرین به‌روزرسانی:</div>
                <div class="info-value">
                    <i class="fa fa-sync-alt calendar-icon"></i>
                    @Model.UpdatedAt.Value.ToString("yyyy/MM/dd HH:mm") توسط <strong>@Model.UpdatedBy</strong>
                </div>
            </div>
        }

        @if (Model.DeletedAt.HasValue)
        {
            <div class="info-row">
                <div class="info-label">تاریخ حذف:</div>
                <div class="info-value">
                    <i class="fa fa-trash calendar-icon"></i>
                    @Model.DeletedAt.Value.ToString("yyyy/MM/dd HH:mm") توسط <strong>@Model.DeletedBy</strong>
                </div>
            </div>
        }

        <div class="audit-trail">
            <h3 style="margin: 0 0 10px 0; color: #007bff;">تاریخچه عملیات</h3>
            <div class="audit-item">
                <span class="audit-user">@Model.CreatedBy</span>
                <span class="audit-time">(@Model.CreatedAt.ToString("yyyy/MM/dd HH:mm"))</span>
                <span class="audit-action">ایجاد کلینیک</span>
            </div>

            @if (Model.UpdatedAt.HasValue)
            {
                <div class="audit-item">
                    <span class="audit-user">@Model.UpdatedBy</span>
                    <span class="audit-time">(@Model.UpdatedAt.Value.ToString("yyyy/MM/dd HH:mm"))</span>
                    <span class="audit-action">به‌روزرسانی اطلاعات</span>
                </div>
            }

            @if (Model.DeletedAt.HasValue)
            {
                <div class="audit-item">
                    <span class="audit-user">@Model.DeletedBy</span>
                    <span class="audit-time">(@Model.DeletedAt.Value.ToString("yyyy/MM/dd HH:mm"))</span>
                    <span class="audit-action">حذف کلینیک</span>
                </div>
            }
        </div>
    </div>

    <!-- نوار اقدامات -->
    <div class="actions-bar no-print">
        <a href="javascript:window.print()" class="btn btn-outline-secondary">
            <i class="fa fa-print"></i> چاپ اطلاعات
        </a>
        <a href="@Url.RouteUrl("Admin_default", new { controller = "Clinic", action = "Index" })"
           class="btn btn-outline-secondary">
            <i class="fa fa-arrow-left"></i> بازگشت به لیست
        </a>
        @if (!Model.DeletedAt.HasValue)
        {
            <a href="@Url.RouteUrl("Admin_default", new { controller = "Clinic", action = "Edit", id = Model.ClinicId })"
               class="btn btn-primary">
                <i class="fa fa-edit"></i> ویرایش اطلاعات
            </a>
            <a href="@Url.RouteUrl("Admin_default", new { controller = "Clinic", action = "Delete", id = Model.ClinicId })"
               class="btn btn-danger">
                <i class="fa fa-trash"></i> حذف کلینیک
            </a>
        }
    </div>
</div>

<!-- اسکریپت‌های حیاتی برای عملکرد بالا -->
<script type="text/javascript">
    // این اسکریپت‌ها به صورت inline برای کاهش تعداد درخواست‌ها اضافه شده‌اند
    (function() {
        'use strict';

        document.addEventListener('DOMContentLoaded', function() {
            // تنظیم کلیدهای میانبر پزشکی
            document.addEventListener('keydown', function(e) {
                // Alt + P برای چاپ
                if (e.altKey && e.key === 'p') {
                    e.preventDefault();
                    window.print();
                }

                // Alt + B برای بازگشت
                if (e.altKey && e.key === 'b') {
                    e.preventDefault();
                    window.location.href = '@Url.RouteUrl("Admin_default", new { controller = "Clinic", action = "Index" })';
                }

                // Alt + E برای ویرایش
                if (e.altKey && e.key === 'e' && document.querySelector('.btn-primary')) {
                    e.preventDefault();
                    document.querySelector('.btn-primary').click();
                }

                // Alt + D برای حذف
                if (e.altKey && e.key === 'd' && document.querySelector('.btn-danger')) {
                    e.preventDefault();
                    document.querySelector('.btn-danger').click();
                }
            });

            // بهینه‌سازی برای دستگاه‌های پزشکی
            if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.body.style.transition = 'none';
            }

            // راهنمای سریع برای کاربران جدید
            if (!sessionStorage.getItem('clinicDetailsHelpShown')) {
                setTimeout(() => {
                    alert('راهنمای جزئیات کلینیک:\n' +
                          '- Alt+P: چاپ اطلاعات\n' +
                          '- Alt+B: بازگشت به لیست\n' +
                          '- Alt+E: ویرایش اطلاعات\n' +
                          '- Alt+D: حذف کلینیک');
                    sessionStorage.setItem('clinicDetailsHelpShown', 'true');
                }, 2000);
            }

            // افزودن تاریخ شمسی به عنوان کمک بصری
            const gregorianDateElements = document.querySelectorAll('.calendar-icon');
            gregorianDateElements.forEach(element => {
                const parent = element.parentElement;
                const gregorianDate = parent.textContent.match(/\d{4}\/\d{2}\/\d{2} \d{2}:\d{2}/);

                if (gregorianDate) {
                    const dateParts = gregorianDate[0].split(' ')[0].split('/');
                    const time = gregorianDate[0].split(' ')[1];

                    // تبدیل تاریخ میلادی به شمسی
                    // اینجا باید تابع تبدیل تاریخ شمسی اضافه شود
                    // برای مثال:
                    // const jalaliDate = convertToJalali(new Date(dateParts[0], dateParts[1]-1, dateParts[2]));

                    // ایجاد اسپن برای تاریخ شمسی
                    const jalaliSpan = document.createElement('span');
                    jalaliSpan.className = 'text-muted mr-2';
                    jalaliSpan.style.fontSize = '0.85em';
                    jalaliSpan.textContent = '(تاریخ شمسی مثال: 1402/05/15)';

                    parent.appendChild(jalaliSpan);
                }
            });

            // شبیه‌سازی نقشه برای محیط پزشکی
            const mapContainer = document.querySelector('.map-container');
            if (mapContainer) {
                // در سیستم واقعی، اینجا کد نقشه واقعی اضافه می‌شود
                mapContainer.addEventListener('click', function() {
                    alert('در سیستم واقعی، این بخش نقشه کلینیک را نمایش می‌دهد.\n' +
                          'برای دیدن نقشه دقیق، می‌توانید از سرویس‌های نقشه‌برداری استفاده کنید.');
                });
            }
        });
    })();
</script>